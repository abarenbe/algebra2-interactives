<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factor by Grouping | 4.4 Factoring Polynomials</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .site-nav {
            background: rgba(0,0,0,0.2);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255,255,255,0.15);
            transition: all 0.3s ease;
            font-size: 0.95em;
        }

        .nav-link:hover { background: rgba(255,255,255,0.25); }
        .nav-title { color: white; font-weight: 600; font-size: 1em; }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p { font-size: 1.1em; opacity: 0.9; }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .tab-btn:hover { background: rgba(255,255,255,0.3); }
        .tab-btn.active { background: white; color: #667eea; font-weight: bold; }

        .section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .section.active { display: block; }

        h2 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-top: 0;
        }

        h3 { color: #764ba2; margin-top: 25px; }

        .info-box {
            background: linear-gradient(135deg, #e8f4fd 0%, #e0e7ff 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .why-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #f59e0b;
        }

        .formula-box {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #ffc107;
            font-size: 1.1em;
            text-align: center;
        }

        .example-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .example-card h4 {
            color: #667eea;
            margin: 0 0 15px 0;
        }

        .polynomial-display {
            font-size: 1.4em;
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #667eea;
            font-family: 'Times New Roman', serif;
        }

        .step-navigator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .step-nav-btn {
            padding: 10px 20px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .step-nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        .step-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .step-indicator {
            font-weight: 600;
            color: #667eea;
        }

        .step-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 10px 0;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s ease;
        }

        .step-dot.active { background: #667eea; transform: scale(1.2); }
        .step-dot.completed { background: #28a745; }

        .watch-step {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            min-height: 150px;
        }

        .watch-step-title {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .watch-work {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            line-height: 2;
        }

        .highlight { background: #fff3cd; padding: 2px 6px; border-radius: 4px; }
        .highlight-green { background: #d4edda; padding: 2px 6px; border-radius: 4px; }
        .highlight-blue { background: #cce5ff; padding: 2px 6px; border-radius: 4px; }
        .highlight-pink { background: #f8d7da; padding: 2px 6px; border-radius: 4px; }

        .problem-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .step-container {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .step-number.completed { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }

        .step-title {
            font-weight: 600;
            color: #333;
            font-size: 1.05em;
        }

        .step-content { margin-left: 47px; }

        .step-completed-text {
            color: #28a745;
            font-weight: 500;
            margin-left: 47px;
            padding: 8px 12px;
            background: #d4edda;
            border-radius: 6px;
            display: inline-block;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        input[type="text"] {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            flex: 1;
            min-width: 150px;
        }

        input[type="text"]:focus {
            border-color: #667eea;
            outline: none;
        }

        input[type="text"].correct {
            border-color: #28a745;
            background: #d4edda;
        }

        input[type="text"].incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .feedback.show { display: block; }
        .feedback.correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback.incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        .score-display {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.2em;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .hidden { display: none !important; }

        .scratch-workspace {
            background: #fffbeb;
            border: 2px dashed #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .scratch-workspace h4 {
            margin: 0 0 15px 0;
            color: #92400e;
        }

        .scratch-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 12px 15px;
            align-items: center;
        }

        .scratch-label {
            font-weight: 500;
            color: #78716c;
            text-align: right;
        }

        .scratch-input {
            padding: 10px 12px;
            border: 1px dashed #d4d4d4;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            background: rgba(255,255,255,0.8);
            max-width: 300px;
        }

        .scratch-input:focus {
            border-color: #667eea;
            border-style: solid;
            outline: none;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .diff-btn {
            padding: 8px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .diff-btn:hover { border-color: #667eea; }
        .diff-btn.active { background: #667eea; color: white; border-color: #667eea; }

        .final-answer-section {
            background: #e0e7ff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .final-answer-section h4 {
            margin: 0 0 15px 0;
            color: #4338ca;
        }

        .grouping-visual {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin: 15px 0;
            font-size: 1.2em;
        }

        .group-box {
            padding: 10px 15px;
            border-radius: 8px;
            font-family: 'Times New Roman', serif;
        }

        .group-1 { background: #dbeafe; border: 2px solid #3b82f6; }
        .group-2 { background: #fce7f3; border: 2px solid #ec4899; }

        @media (max-width: 768px) {
            header h1 { font-size: 1.6em; }
            .tab-btn { padding: 10px 16px; font-size: 0.9em; }
            .polynomial-display { font-size: 1.2em; }
            .step-content { margin-left: 0; margin-top: 10px; }
            .step-completed-text { margin-left: 0; }
            .scratch-grid { grid-template-columns: 1fr; }
            .scratch-label { text-align: left; }
            .scratch-input { max-width: 100%; }
            .grouping-visual { font-size: 1em; }
        }
    </style>
</head>
<body>
    <nav class="site-nav">
        <a href="./" class="nav-link">&larr; 4.4 Factoring</a>
        <span class="nav-title">Factor by Grouping</span>
    </nav>

    <div class="container">
        <header>
            <h1>Factor by Grouping</h1>
            <p>Factor 4-term polynomials by grouping pairs</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="showSection('learn')">Learn</button>
            <button class="tab-btn" onclick="showSection('watch')">See</button>
            <button class="tab-btn" onclick="showSection('practice')">Practice</button>
            <button class="tab-btn" onclick="showSection('solo')">Do</button>
        </div>

        <!-- LEARN SECTION -->
        <div id="learn" class="section active">
            <h2>Understanding Factor by Grouping</h2>

            <div class="info-box">
                <h3 style="margin-top:0;">What is Factor by Grouping?</h3>
                <p><strong>Factor by grouping</strong> is a technique used for polynomials with 4 terms. We split the polynomial into two groups, factor each group, then factor out the common binomial.</p>
            </div>

            <div class="formula-box">
                <strong>The Pattern:</strong><br><br>
                ra + rb + sa + sb<br>
                = r(a + b) + s(a + b)<br>
                = <strong>(r + s)(a + b)</strong>
            </div>

            <div class="why-box">
                <h3 style="margin-top:0;">Why Does Grouping Work?</h3>
                <p>Factor by grouping works because of the <strong>distributive property</strong> applied twice:</p>
                <ol>
                    <li><strong>First grouping:</strong> We find a common factor in each pair of terms</li>
                    <li><strong>Second grouping:</strong> If done correctly, both groups share a common binomial factor</li>
                    <li><strong>Final step:</strong> We factor out that common binomial, leaving another binomial</li>
                </ol>
                <p>This works because when we expand (r + s)(a + b), we get ra + rb + sa + sb - exactly 4 terms where pairs share factors!</p>
            </div>

            <h3>Step-by-Step Process</h3>
            <div class="example-card">
                <h4>How to Factor by Grouping</h4>
                <ol>
                    <li><strong>Group the first two terms and last two terms</strong></li>
                    <li><strong>Factor out the GCF from each group</strong></li>
                    <li><strong>Identify the common binomial factor</strong></li>
                    <li><strong>Factor out the common binomial</strong></li>
                    <li><strong>Check if any factor can be factored further</strong></li>
                </ol>
            </div>

            <h3>Detailed Example</h3>
            <div class="example-card">
                <h4>Factor: x<sup>3</sup> + 5x<sup>2</sup> - 4x - 20</h4>

                <div class="grouping-visual">
                    <div class="group-box group-1">x<sup>3</sup> + 5x<sup>2</sup></div>
                    <span>+</span>
                    <div class="group-box group-2">-4x - 20</div>
                </div>

                <div style="font-family:'Courier New', monospace; line-height:2.2; padding:15px; background:white; border-radius:8px;">
                    <div><span class="highlight-blue">x<sup>3</sup> + 5x<sup>2</sup></span> <span class="highlight-pink">- 4x - 20</span> <span style="color:#666;">&larr; Group terms</span></div>
                    <div>= <span class="highlight-blue">x<sup>2</sup>(x + 5)</span> <span class="highlight-pink">- 4(x + 5)</span> <span style="color:#666;">&larr; Factor each group</span></div>
                    <div>= <span class="highlight">(x + 5)</span>(x<sup>2</sup> - 4) <span style="color:#666;">&larr; Factor out (x + 5)</span></div>
                    <div>= <span class="highlight-green">(x + 5)(x - 2)(x + 2)</span> <span style="color:#666;">&larr; Factor difference of squares</span></div>
                </div>
            </div>

            <div class="info-box">
                <h3 style="margin-top:0;">Key Tips</h3>
                <ul>
                    <li><strong>Sign matters:</strong> When factoring the second group, be careful with negative signs. If the third term is negative, you may need to factor out a negative.</li>
                    <li><strong>Check for match:</strong> After factoring each group, the binomial factors must be identical for this method to work.</li>
                    <li><strong>Not always possible:</strong> If the binomials don't match, try regrouping or the polynomial may not factor by grouping.</li>
                    <li><strong>Factor completely:</strong> Always check if the resulting factors can be factored further (difference of squares, trinomials, etc.)</li>
                </ul>
            </div>

            <div class="why-box">
                <h3 style="margin-top:0;">When to Use Factor by Grouping</h3>
                <ul>
                    <li><strong>4-term polynomials</strong> - This is the primary use case</li>
                    <li><strong>Cubic polynomials</strong> - Often ax<sup>3</sup> + bx<sup>2</sup> + cx + d can be factored this way</li>
                    <li><strong>When other methods don't apply</strong> - Not a perfect cube, not a simple trinomial</li>
                </ul>
            </div>
        </div>

        <!-- WATCH SECTION -->
        <div id="watch" class="section">
            <h2>See</h2>

            <div class="difficulty-selector">
                <button class="diff-btn active" onclick="selectWatchExample(0)">Example 1</button>
                <button class="diff-btn" onclick="selectWatchExample(1)">Example 2</button>
                <button class="diff-btn" onclick="selectWatchExample(2)">Example 3</button>
            </div>

            <div class="polynomial-display" id="watch-problem">x<sup>3</sup> + 5x<sup>2</sup> - 4x - 20</div>

            <div class="step-dots" id="watch-dots"></div>

            <div class="watch-step" id="watch-step-content">
                <div class="watch-step-title" id="watch-step-title">Step 1</div>
                <div class="watch-work" id="watch-work"></div>
            </div>

            <div class="step-navigator">
                <button class="step-nav-btn" id="watch-prev" onclick="watchPrev()">← Previous</button>
                <span class="step-indicator" id="watch-indicator">Step 1 of 5</span>
                <button class="step-nav-btn" id="watch-next" onclick="watchNext()">Next →</button>
            </div>
        </div>

        <!-- PRACTICE SECTION -->
        <div id="practice" class="section">
            <h2>Practice</h2>
            <p>Factor each polynomial step by step. Work through each group!</p>

            <div class="score-display">
                Score: <span id="practice-score">0</span> / <span id="practice-total">0</span>
                <div class="progress-bar"><div class="progress-fill" id="practice-progress" style="width:0%"></div></div>
            </div>

            <div class="problem-card">
                <h3>Factor completely:</h3>
                <div class="polynomial-display" id="practice-problem"></div>

                <!-- Step 1: Factor first group -->
                <div class="step-container" id="practice-step1">
                    <div class="step-header">
                        <div class="step-number" id="practice-step1-num">1</div>
                        <div class="step-title">Factor the first group: <span id="practice-group1" style="color:#3b82f6;"></span></div>
                    </div>
                    <div class="step-content" id="practice-step1-content">
                        <div class="input-group">
                            <input type="text" id="practice-step1-answer" placeholder="e.g., x²(x+5)">
                            <button class="btn btn-primary" onclick="checkPracticeStep1()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="practice-step1-complete"></div>
                </div>

                <!-- Step 2: Factor second group -->
                <div class="step-container hidden" id="practice-step2">
                    <div class="step-header">
                        <div class="step-number" id="practice-step2-num">2</div>
                        <div class="step-title">Factor the second group: <span id="practice-group2" style="color:#ec4899;"></span></div>
                    </div>
                    <div class="step-content" id="practice-step2-content">
                        <div class="input-group">
                            <input type="text" id="practice-step2-answer" placeholder="e.g., -4(x+5)">
                            <button class="btn btn-primary" onclick="checkPracticeStep2()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="practice-step2-complete"></div>
                </div>

                <!-- Step 3: Identify common binomial -->
                <div class="step-container hidden" id="practice-step3">
                    <div class="step-header">
                        <div class="step-number" id="practice-step3-num">3</div>
                        <div class="step-title">What is the common binomial factor?</div>
                    </div>
                    <div class="step-content" id="practice-step3-content">
                        <div class="input-group">
                            <input type="text" id="practice-step3-answer" placeholder="e.g., (x+5)">
                            <button class="btn btn-primary" onclick="checkPracticeStep3()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="practice-step3-complete"></div>
                </div>

                <!-- Step 4: Final answer -->
                <div class="step-container hidden" id="practice-step4">
                    <div class="step-header">
                        <div class="step-number" id="practice-step4-num">4</div>
                        <div class="step-title">Write the completely factored form</div>
                    </div>
                    <div class="step-content" id="practice-step4-content">
                        <div class="input-group">
                            <input type="text" id="practice-step4-answer" placeholder="e.g., (x+5)(x-2)(x+2)">
                            <button class="btn btn-primary" onclick="checkPracticeStep4()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="practice-step4-complete"></div>
                </div>

                <div class="feedback" id="practice-feedback"></div>
                <button class="btn btn-success" onclick="newPracticeProblem()" style="margin-top:15px;">New Problem</button>
            </div>
        </div>

        <!-- SOLO SECTION -->
        <div id="solo" class="section">
            <h2>Do</h2>
            <p>Work through problems independently using the scratch workspace.</p>

            <div class="difficulty-selector">
                <button class="diff-btn active" onclick="setSoloDifficulty('easy')">Easy</button>
                <button class="diff-btn" onclick="setSoloDifficulty('medium')">Medium</button>
                <button class="diff-btn" onclick="setSoloDifficulty('hard')">Hard</button>
            </div>

            <div class="score-display">
                Score: <span id="solo-score">0</span> / <span id="solo-total">0</span>
                <div class="progress-bar"><div class="progress-fill" id="solo-progress" style="width:0%"></div></div>
            </div>

            <div class="problem-card">
                <h3>Factor completely:</h3>
                <div class="polynomial-display" id="solo-problem"></div>

                <div class="scratch-workspace">
                    <h4>Scratch Workspace</h4>
                    <div class="scratch-grid">
                        <span class="scratch-label">Group 1:</span>
                        <input type="text" class="scratch-input" id="scratch-g1-terms" placeholder="First two terms">

                        <span class="scratch-label">Factor Group 1:</span>
                        <input type="text" class="scratch-input" id="scratch-g1-factored" placeholder="e.g., x²(x+5)">

                        <span class="scratch-label">Group 2:</span>
                        <input type="text" class="scratch-input" id="scratch-g2-terms" placeholder="Last two terms">

                        <span class="scratch-label">Factor Group 2:</span>
                        <input type="text" class="scratch-input" id="scratch-g2-factored" placeholder="e.g., -4(x+5)">

                        <span class="scratch-label">Common binomial:</span>
                        <input type="text" class="scratch-input" id="scratch-common" placeholder="e.g., (x+5)">

                        <span class="scratch-label">Other factor:</span>
                        <input type="text" class="scratch-input" id="scratch-other" placeholder="e.g., (x²-4)">

                        <span class="scratch-label">Factor more?</span>
                        <input type="text" class="scratch-input" id="scratch-more" placeholder="Can you factor further?">
                    </div>
                </div>

                <div class="final-answer-section">
                    <h4>Final Answer</h4>
                    <div class="input-group">
                        <input type="text" id="solo-answer" placeholder="Enter completely factored form">
                        <button class="btn btn-primary" onclick="checkSoloAnswer()">Submit</button>
                    </div>
                </div>

                <div class="feedback" id="solo-feedback"></div>
                <button class="btn btn-success" onclick="newSoloProblem()" style="margin-top:15px;">New Problem</button>
            </div>
        </div>
    </div>

    <script>
        // Tab navigation
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');

            if (id === 'watch') initWatch();
            if (id === 'practice' && !currentPractice) newPracticeProblem();
            if (id === 'solo' && !currentSolo) newSoloProblem();
        }

        function normalizeAnswer(str) {
            return str.replace(/\s+/g, '').replace(/\*/g, '').replace(/\^/g, '').replace(/\u00B2/g, '2').replace(/\u00B3/g, '3').replace(/\u2074/g, '4').replace(/\u2075/g, '5').toLowerCase();
        }

        function checkAnswerMatch(userAnswer, correctAnswers) {
            const normalized = normalizeAnswer(userAnswer);
            return correctAnswers.some(ans => normalizeAnswer(ans) === normalized);
        }

        // =====================
        // WATCH SECTION
        // =====================
        const watchExamples = [
            {
                problem: "x³ + 5x² - 4x - 20",
                problemHTML: "x<sup>3</sup> + 5x<sup>2</sup> - 4x - 20",
                steps: [
                    { title: "Step 1: Identify the groups", content: "Split into two groups of two terms:<br><br><span class='highlight-blue'>x³ + 5x²</span> and <span class='highlight-pink'>-4x - 20</span><br><br>We'll factor each group separately." },
                    { title: "Step 2: Factor the first group", content: "<span class='highlight-blue'>x³ + 5x²</span><br><br>GCF of x³ and 5x² is <strong>x²</strong><br><br>x³ + 5x² = <span class='highlight'>x²(x + 5)</span>" },
                    { title: "Step 3: Factor the second group", content: "<span class='highlight-pink'>-4x - 20</span><br><br>GCF of -4x and -20 is <strong>-4</strong><br><br>-4x - 20 = <span class='highlight'>-4(x + 5)</span><br><br><em>Note: Factor out -4 (not 4) so the binomials match!</em>" },
                    { title: "Step 4: Factor out the common binomial", content: "x²<span class='highlight'>(x + 5)</span> - 4<span class='highlight'>(x + 5)</span><br><br>Both terms have <span class='highlight'>(x + 5)</span> as a factor!<br><br>= (x + 5)(x² - 4)" },
                    { title: "Step 5: Factor completely", content: "(x + 5)<span class='highlight'>(x² - 4)</span><br><br>x² - 4 is a <strong>difference of squares</strong>!<br>x² - 4 = (x - 2)(x + 2)<br><br>= <span class='highlight-green'>(x + 5)(x - 2)(x + 2)</span>" }
                ]
            },
            {
                problem: "x³ - x² - 9x + 9",
                problemHTML: "x<sup>3</sup> - x<sup>2</sup> - 9x + 9",
                steps: [
                    { title: "Step 1: Identify the groups", content: "Split into two groups:<br><br><span class='highlight-blue'>x³ - x²</span> and <span class='highlight-pink'>-9x + 9</span>" },
                    { title: "Step 2: Factor the first group", content: "<span class='highlight-blue'>x³ - x²</span><br><br>GCF is x²<br><br>x³ - x² = <span class='highlight'>x²(x - 1)</span>" },
                    { title: "Step 3: Factor the second group", content: "<span class='highlight-pink'>-9x + 9</span><br><br>GCF is -9<br><br>-9x + 9 = <span class='highlight'>-9(x - 1)</span><br><br><em>We factor out -9 so we get (x - 1) to match the first group</em>" },
                    { title: "Step 4: Factor out the common binomial", content: "x²<span class='highlight'>(x - 1)</span> - 9<span class='highlight'>(x - 1)</span><br><br>= (x - 1)(x² - 9)" },
                    { title: "Step 5: Factor completely", content: "(x - 1)(x² - 9)<br><br>x² - 9 = (x - 3)(x + 3)<br><br>= <span class='highlight-green'>(x - 1)(x - 3)(x + 3)</span>" }
                ]
            },
            {
                problem: "x³ + 2x² - x - 2",
                problemHTML: "x<sup>3</sup> + 2x<sup>2</sup> - x - 2",
                steps: [
                    { title: "Step 1: Identify the groups", content: "Split into two groups:<br><br><span class='highlight-blue'>x³ + 2x²</span> and <span class='highlight-pink'>-x - 2</span>" },
                    { title: "Step 2: Factor the first group", content: "<span class='highlight-blue'>x³ + 2x²</span><br><br>GCF is x²<br><br>x³ + 2x² = <span class='highlight'>x²(x + 2)</span>" },
                    { title: "Step 3: Factor the second group", content: "<span class='highlight-pink'>-x - 2</span><br><br>GCF is -1<br><br>-x - 2 = <span class='highlight'>-1(x + 2)</span><br><br><em>We can also write this as -(x + 2)</em>" },
                    { title: "Step 4: Factor out the common binomial", content: "x²<span class='highlight'>(x + 2)</span> - 1<span class='highlight'>(x + 2)</span><br><br>= (x + 2)(x² - 1)" },
                    { title: "Step 5: Factor completely", content: "(x + 2)(x² - 1)<br><br>x² - 1 = (x - 1)(x + 1)<br><br>= <span class='highlight-green'>(x + 2)(x - 1)(x + 1)</span>" }
                ]
            }
        ];

        let currentWatchExample = 0;
        let currentWatchStep = 0;

        function initWatch() {
            selectWatchExample(0);
        }

        function selectWatchExample(idx) {
            currentWatchExample = idx;
            currentWatchStep = 0;

            document.querySelectorAll('#watch .diff-btn').forEach((b, i) => {
                b.classList.toggle('active', i === idx);
            });

            const example = watchExamples[idx];
            document.getElementById('watch-problem').innerHTML = example.problemHTML;

            const dotsContainer = document.getElementById('watch-dots');
            dotsContainer.innerHTML = example.steps.map((_, i) =>
                `<div class="step-dot${i === 0 ? ' active' : ''}"></div>`
            ).join('');

            updateWatchStep();
        }

        function updateWatchStep() {
            const example = watchExamples[currentWatchExample];
            const step = example.steps[currentWatchStep];

            document.getElementById('watch-step-title').textContent = step.title;
            document.getElementById('watch-work').innerHTML = step.content;
            document.getElementById('watch-indicator').textContent = `Step ${currentWatchStep + 1} of ${example.steps.length}`;

            document.querySelectorAll('#watch .step-dot').forEach((dot, i) => {
                dot.classList.remove('active', 'completed');
                if (i < currentWatchStep) dot.classList.add('completed');
                if (i === currentWatchStep) dot.classList.add('active');
            });

            document.getElementById('watch-prev').disabled = currentWatchStep === 0;
            document.getElementById('watch-next').disabled = currentWatchStep === example.steps.length - 1;
        }

        function watchPrev() {
            if (currentWatchStep > 0) {
                currentWatchStep--;
                updateWatchStep();
            }
        }

        function watchNext() {
            const example = watchExamples[currentWatchExample];
            if (currentWatchStep < example.steps.length - 1) {
                currentWatchStep++;
                updateWatchStep();
            }
        }

        // =====================
        // PRACTICE SECTION
        // =====================
        const practiceProblems = [
            {
                expr: "x³ + 5x² - 4x - 20",
                exprHTML: "x<sup>3</sup> + 5x<sup>2</sup> - 4x - 20",
                group1: "x³ + 5x²",
                group2: "-4x - 20",
                step1: ["x²(x+5)", "x^2(x+5)"],
                step2: ["-4(x+5)"],
                common: ["(x+5)", "x+5"],
                final: ["(x+5)(x-2)(x+2)", "(x+5)(x+2)(x-2)", "(x-2)(x+2)(x+5)", "(x+2)(x-2)(x+5)"]
            },
            {
                expr: "x³ - x² - 9x + 9",
                exprHTML: "x<sup>3</sup> - x<sup>2</sup> - 9x + 9",
                group1: "x³ - x²",
                group2: "-9x + 9",
                step1: ["x²(x-1)", "x^2(x-1)"],
                step2: ["-9(x-1)"],
                common: ["(x-1)", "x-1"],
                final: ["(x-1)(x-3)(x+3)", "(x-1)(x+3)(x-3)", "(x-3)(x+3)(x-1)", "(x+3)(x-3)(x-1)"]
            },
            {
                expr: "x³ + 2x² - x - 2",
                exprHTML: "x<sup>3</sup> + 2x<sup>2</sup> - x - 2",
                group1: "x³ + 2x²",
                group2: "-x - 2",
                step1: ["x²(x+2)", "x^2(x+2)"],
                step2: ["-1(x+2)", "-(x+2)"],
                common: ["(x+2)", "x+2"],
                final: ["(x+2)(x-1)(x+1)", "(x+2)(x+1)(x-1)", "(x-1)(x+1)(x+2)", "(x+1)(x-1)(x+2)"]
            },
            {
                expr: "x³ - 3x² - 4x + 12",
                exprHTML: "x<sup>3</sup> - 3x<sup>2</sup> - 4x + 12",
                group1: "x³ - 3x²",
                group2: "-4x + 12",
                step1: ["x²(x-3)", "x^2(x-3)"],
                step2: ["-4(x-3)"],
                common: ["(x-3)", "x-3"],
                final: ["(x-3)(x-2)(x+2)", "(x-3)(x+2)(x-2)", "(x-2)(x+2)(x-3)", "(x+2)(x-2)(x-3)"]
            }
        ];

        let currentPractice = null;
        let practiceScore = 0;
        let practiceTotal = 0;

        function newPracticeProblem() {
            currentPractice = practiceProblems[Math.floor(Math.random() * practiceProblems.length)];

            document.getElementById('practice-problem').innerHTML = currentPractice.exprHTML;
            document.getElementById('practice-group1').textContent = currentPractice.group1;
            document.getElementById('practice-group2').textContent = currentPractice.group2;

            // Reset all steps
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`practice-step${i}`).classList.remove('hidden');
                document.getElementById(`practice-step${i}-num`).classList.remove('completed');
                document.getElementById(`practice-step${i}-content`).classList.remove('hidden');
                document.getElementById(`practice-step${i}-complete`).classList.add('hidden');
                const input = document.getElementById(`practice-step${i}-answer`);
                if (input) {
                    input.value = '';
                    input.classList.remove('correct', 'incorrect');
                }
            }

            document.getElementById('practice-step2').classList.add('hidden');
            document.getElementById('practice-step3').classList.add('hidden');
            document.getElementById('practice-step4').classList.add('hidden');

            document.getElementById('practice-feedback').className = 'feedback';
            document.getElementById('practice-feedback').style.display = 'none';
        }

        function checkPracticeStep1() {
            const input = document.getElementById('practice-step1-answer');
            const isCorrect = checkAnswerMatch(input.value, currentPractice.step1);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('practice-step1-num').classList.add('completed');
                document.getElementById('practice-step1-content').classList.add('hidden');
                document.getElementById('practice-step1-complete').textContent = currentPractice.step1[0];
                document.getElementById('practice-step1-complete').classList.remove('hidden');

                document.getElementById('practice-step2').classList.remove('hidden');
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkPracticeStep2() {
            const input = document.getElementById('practice-step2-answer');
            const isCorrect = checkAnswerMatch(input.value, currentPractice.step2);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('practice-step2-num').classList.add('completed');
                document.getElementById('practice-step2-content').classList.add('hidden');
                document.getElementById('practice-step2-complete').textContent = currentPractice.step2[0];
                document.getElementById('practice-step2-complete').classList.remove('hidden');

                document.getElementById('practice-step3').classList.remove('hidden');
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkPracticeStep3() {
            const input = document.getElementById('practice-step3-answer');
            const isCorrect = checkAnswerMatch(input.value, currentPractice.common);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('practice-step3-num').classList.add('completed');
                document.getElementById('practice-step3-content').classList.add('hidden');
                document.getElementById('practice-step3-complete').textContent = `Common binomial: ${currentPractice.common[0]}`;
                document.getElementById('practice-step3-complete').classList.remove('hidden');

                document.getElementById('practice-step4').classList.remove('hidden');
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkPracticeStep4() {
            const input = document.getElementById('practice-step4-answer');
            const isCorrect = checkAnswerMatch(input.value, currentPractice.final);

            practiceTotal++;
            const feedback = document.getElementById('practice-feedback');

            if (isCorrect) {
                practiceScore++;
                input.classList.add('correct');
                document.getElementById('practice-step4-num').classList.add('completed');
                document.getElementById('practice-step4-content').classList.add('hidden');
                document.getElementById('practice-step4-complete').textContent = `Final: ${currentPractice.final[0]}`;
                document.getElementById('practice-step4-complete').classList.remove('hidden');

                feedback.innerHTML = '<strong>Excellent!</strong> Perfect factoring by grouping!';
                feedback.className = 'feedback correct show';
            } else {
                input.classList.add('incorrect');
                feedback.innerHTML = `<strong>Not quite.</strong> The correct answer is: ${currentPractice.final[0]}`;
                feedback.className = 'feedback incorrect show';
            }

            document.getElementById('practice-score').textContent = practiceScore;
            document.getElementById('practice-total').textContent = practiceTotal;
            document.getElementById('practice-progress').style.width = `${(practiceScore/Math.max(practiceTotal,1))*100}%`;
        }

        // =====================
        // SOLO SECTION
        // =====================
        const soloProblems = {
            easy: [
                { expr: "x³ + 2x² + 3x + 6", exprHTML: "x<sup>3</sup> + 2x<sup>2</sup> + 3x + 6", answers: ["(x+2)(x²+3)", "(x+2)(x^2+3)"] },
                { expr: "x³ - 3x² + 2x - 6", exprHTML: "x<sup>3</sup> - 3x<sup>2</sup> + 2x - 6", answers: ["(x-3)(x²+2)", "(x-3)(x^2+2)"] },
                { expr: "x³ + x² + x + 1", exprHTML: "x<sup>3</sup> + x<sup>2</sup> + x + 1", answers: ["(x+1)(x²+1)", "(x+1)(x^2+1)"] },
                { expr: "x³ - 2x² + 5x - 10", exprHTML: "x<sup>3</sup> - 2x<sup>2</sup> + 5x - 10", answers: ["(x-2)(x²+5)", "(x-2)(x^2+5)"] }
            ],
            medium: [
                { expr: "x³ + 5x² - 4x - 20", exprHTML: "x<sup>3</sup> + 5x<sup>2</sup> - 4x - 20", answers: ["(x+5)(x-2)(x+2)", "(x+5)(x+2)(x-2)", "(x-2)(x+2)(x+5)", "(x+2)(x-2)(x+5)"] },
                { expr: "x³ - x² - 9x + 9", exprHTML: "x<sup>3</sup> - x<sup>2</sup> - 9x + 9", answers: ["(x-1)(x-3)(x+3)", "(x-1)(x+3)(x-3)", "(x-3)(x+3)(x-1)", "(x+3)(x-3)(x-1)"] },
                { expr: "x³ + 2x² - x - 2", exprHTML: "x<sup>3</sup> + 2x<sup>2</sup> - x - 2", answers: ["(x+2)(x-1)(x+1)", "(x+2)(x+1)(x-1)", "(x-1)(x+1)(x+2)", "(x+1)(x-1)(x+2)"] },
                { expr: "x³ - 3x² - 4x + 12", exprHTML: "x<sup>3</sup> - 3x<sup>2</sup> - 4x + 12", answers: ["(x-3)(x-2)(x+2)", "(x-3)(x+2)(x-2)", "(x-2)(x+2)(x-3)", "(x+2)(x-2)(x-3)"] }
            ],
            hard: [
                { expr: "x³ + 4x² - 9x - 36", exprHTML: "x<sup>3</sup> + 4x<sup>2</sup> - 9x - 36", answers: ["(x+4)(x-3)(x+3)", "(x+4)(x+3)(x-3)", "(x-3)(x+3)(x+4)", "(x+3)(x-3)(x+4)"] },
                { expr: "x³ - 2x² - 16x + 32", exprHTML: "x<sup>3</sup> - 2x<sup>2</sup> - 16x + 32", answers: ["(x-2)(x-4)(x+4)", "(x-2)(x+4)(x-4)", "(x-4)(x+4)(x-2)", "(x+4)(x-4)(x-2)"] },
                { expr: "x³ + 3x² - 25x - 75", exprHTML: "x<sup>3</sup> + 3x<sup>2</sup> - 25x - 75", answers: ["(x+3)(x-5)(x+5)", "(x+3)(x+5)(x-5)", "(x-5)(x+5)(x+3)", "(x+5)(x-5)(x+3)"] },
                { expr: "x³ - 5x² - x + 5", exprHTML: "x<sup>3</sup> - 5x<sup>2</sup> - x + 5", answers: ["(x-5)(x-1)(x+1)", "(x-5)(x+1)(x-1)", "(x-1)(x+1)(x-5)", "(x+1)(x-1)(x-5)"] }
            ]
        };

        let soloDifficulty = 'easy';
        let currentSolo = null;
        let soloScore = 0;
        let soloTotal = 0;

        function setSoloDifficulty(diff) {
            soloDifficulty = diff;
            document.querySelectorAll('#solo .diff-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            newSoloProblem();
        }

        function newSoloProblem() {
            const problems = soloProblems[soloDifficulty];
            currentSolo = problems[Math.floor(Math.random() * problems.length)];

            document.getElementById('solo-problem').innerHTML = currentSolo.exprHTML;

            // Clear scratch workspace
            ['scratch-g1-terms', 'scratch-g1-factored', 'scratch-g2-terms',
             'scratch-g2-factored', 'scratch-common', 'scratch-other', 'scratch-more'].forEach(id => {
                document.getElementById(id).value = '';
            });

            document.getElementById('solo-answer').value = '';
            document.getElementById('solo-answer').classList.remove('correct', 'incorrect');

            document.getElementById('solo-feedback').className = 'feedback';
            document.getElementById('solo-feedback').style.display = 'none';
        }

        function checkSoloAnswer() {
            const input = document.getElementById('solo-answer');
            const isCorrect = checkAnswerMatch(input.value, currentSolo.answers);

            soloTotal++;
            const feedback = document.getElementById('solo-feedback');

            if (isCorrect) {
                soloScore++;
                input.classList.add('correct');
                feedback.innerHTML = '<strong>Correct!</strong> Great job with grouping!';
                feedback.className = 'feedback correct show';
            } else {
                input.classList.add('incorrect');
                feedback.innerHTML = `<strong>Not quite.</strong> The correct answer is: ${currentSolo.answers[0]}`;
                feedback.className = 'feedback incorrect show';
            }

            document.getElementById('solo-score').textContent = soloScore;
            document.getElementById('solo-total').textContent = soloTotal;
            document.getElementById('solo-progress').style.width = `${(soloScore/Math.max(soloTotal,1))*100}%`;
        }

        // Enter key support
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const target = e.target;
                if (target.id === 'practice-step1-answer') checkPracticeStep1();
                else if (target.id === 'practice-step2-answer') checkPracticeStep2();
                else if (target.id === 'practice-step3-answer') checkPracticeStep3();
                else if (target.id === 'practice-step4-answer') checkPracticeStep4();
                else if (target.id === 'solo-answer') checkSoloAnswer();
            }
        });
    </script>
</body>
</html>
