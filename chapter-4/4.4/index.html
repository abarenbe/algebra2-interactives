<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4.4 Factoring Polynomials | Algebra 2 Interactives</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .site-nav {
            background: rgba(0,0,0,0.2);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255,255,255,0.15);
            transition: all 0.3s ease;
            font-size: 0.95em;
        }

        .nav-link:hover { background: rgba(255,255,255,0.25); }
        .nav-title { color: white; font-weight: 600; font-size: 1em; }
        .nav-links { display: flex; gap: 10px; align-items: center; }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p { font-size: 1.1em; opacity: 0.9; }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-btn {
            padding: 10px 18px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        .tab-btn:hover { background: rgba(255,255,255,0.3); }
        .tab-btn.active { background: white; color: #667eea; font-weight: bold; }

        .section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .section.active { display: block; }

        h2 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-top: 0;
        }

        h3 { color: #764ba2; margin-top: 25px; }

        .info-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8e8e8 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .formula-box {
            background: #fff3cd;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #ffc107;
            font-size: 1.1em;
            text-align: center;
        }

        .problem-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .polynomial-display {
            font-size: 1.4em;
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #667eea;
            font-family: 'Times New Roman', serif;
        }

        .step-container {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .step-title {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .step-completed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .step-content {
            margin-left: 47px;
        }

        .step-completed-text {
            color: #28a745;
            font-weight: 500;
            margin-left: 47px;
            padding: 8px 12px;
            background: #d4edda;
            border-radius: 6px;
            display: inline-block;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        input[type="text"] {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            flex: 1;
            min-width: 150px;
        }

        input[type="text"]:focus {
            border-color: #667eea;
            outline: none;
        }

        input[type="text"].correct {
            border-color: #28a745;
            background: #d4edda;
        }

        input[type="text"].incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .feedback.show { display: block; }
        .feedback.correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback.incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        .step-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            line-height: 2;
        }

        .step-display .step {
            padding: 5px 0;
            border-bottom: 1px dashed #ddd;
        }

        .step-display .step:last-child { border-bottom: none; }
        .step-display .highlight { background: #fff3cd; padding: 2px 6px; border-radius: 4px; }

        .score-display {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.2em;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .options { display: grid; gap: 10px; margin: 15px 0; }

        .option-btn {
            padding: 12px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .option-btn:hover:not(:disabled) { border-color: #667eea; background: #f0f0ff; }
        .option-btn.correct { background: #d4edda; border-color: #28a745; }
        .option-btn.incorrect { background: #f8d7da; border-color: #dc3545; }
        .option-btn:disabled { cursor: default; }

        .radio-group {
            display: flex;
            gap: 15px;
            margin: 10px 0;
        }

        .radio-option {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover { border-color: #667eea; }
        .radio-option.selected { border-color: #667eea; background: #f0f0ff; }
        .radio-option.correct { border-color: #28a745; background: #d4edda; }
        .radio-option.incorrect { border-color: #dc3545; background: #f8d7da; }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .example-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
        }

        .example-card h4 {
            color: #667eea;
            margin: 0 0 10px 0;
            font-size: 0.95em;
        }

        .example-card .problem { font-weight: bold; margin-bottom: 8px; }
        .example-card .solution { color: #28a745; }

        .graph-container {
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
        }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            header h1 { font-size: 1.8em; }
            .tab-btn { padding: 8px 14px; font-size: 0.85em; }
            .polynomial-display { font-size: 1.2em; }
            .site-nav { justify-content: center; }
            .nav-title { width: 100%; text-align: center; }
            .step-content { margin-left: 0; margin-top: 10px; }
            .step-completed-text { margin-left: 0; }
        }
    </style>
</head>
<body>
    <nav class="site-nav">
        <a href="../" class="nav-link">&larr; Chapter 4</a>
        <span class="nav-title">4.4 Factoring Polynomials</span>
        <div class="nav-links">
            <a href="../4.3/" class="nav-link">&larr; 4.3</a>
            <a href="../4.5/" class="nav-link" style="opacity:0.5;pointer-events:none;">4.5 &rarr;</a>
        </div>
    </nav>

    <div class="container">
        <header>
            <h1>4.4 Factoring Polynomials</h1>
            <p>Master factoring techniques step by step</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="showSection('learn')">Learn</button>
            <button class="tab-btn" onclick="showSection('gcf')">GCF Factoring</button>
            <button class="tab-btn" onclick="showSection('cubes')">Sum/Diff of Cubes</button>
            <button class="tab-btn" onclick="showSection('grouping')">Factor by Grouping</button>
            <button class="tab-btn" onclick="showSection('theorem')">Factor Theorem</button>
            <button class="tab-btn" onclick="showSection('practice')">Practice Quiz</button>
        </div>

        <!-- LEARN SECTION -->
        <div id="learn" class="section active">
            <h2>Factoring Polynomials</h2>

            <div class="info-box">
                <p>A polynomial is <strong>factored completely</strong> when it's written as a product of unfactorable polynomials with integer coefficients.</p>
            </div>

            <h3>1. Finding Common Monomial Factors (GCF)</h3>
            <p>Always start by factoring out the greatest common factor from all terms.</p>
            <div class="example-grid">
                <div class="example-card">
                    <h4>Example 1</h4>
                    <div class="problem">x³ - 4x² - 5x</div>
                    <div class="solution">= x(x² - 4x - 5)<br>= x(x - 5)(x + 1)</div>
                </div>
                <div class="example-card">
                    <h4>Example 2</h4>
                    <div class="problem">3y⁵ - 48y³</div>
                    <div class="solution">= 3y³(y² - 16)<br>= 3y³(y - 4)(y + 4)</div>
                </div>
            </div>

            <h3>2. Sum and Difference of Two Cubes</h3>
            <div class="formula-box">
                <strong>Sum of Cubes:</strong> a³ + b³ = (a + b)(a² - ab + b²)<br><br>
                <strong>Difference of Cubes:</strong> a³ - b³ = (a - b)(a² + ab + b²)
            </div>
            <p><strong>Memory trick:</strong> "SOAP" - <u>S</u>ame sign, <u>O</u>pposite sign, <u>A</u>lways <u>P</u>ositive</p>
            <div class="example-grid">
                <div class="example-card">
                    <h4>Sum: x³ + 64</h4>
                    <div class="problem">x³ + 4³</div>
                    <div class="solution">= (x + 4)(x² - 4x + 16)</div>
                </div>
                <div class="example-card">
                    <h4>Difference: 27x³ - 8</h4>
                    <div class="problem">(3x)³ - 2³</div>
                    <div class="solution">= (3x - 2)(9x² + 6x + 4)</div>
                </div>
            </div>

            <h3>3. Factor by Grouping</h3>
            <p>For 4-term polynomials, group pairs of terms that share common factors.</p>
            <div class="formula-box">
                ra + rb + sa + sb = r(a + b) + s(a + b) = (r + s)(a + b)
            </div>
            <div class="example-card">
                <h4>Example: z³ + 5z² - 4z - 20</h4>
                <div class="step-display">
                    <div class="step">z³ + 5z² - 4z - 20</div>
                    <div class="step">= z²(z + 5) - 4(z + 5) <span class="highlight">Group and factor</span></div>
                    <div class="step">= (z² - 4)(z + 5) <span class="highlight">Factor out (z + 5)</span></div>
                    <div class="step">= (z - 2)(z + 2)(z + 5) <span class="highlight">Difference of squares</span></div>
                </div>
            </div>

            <h3>4. The Factor Theorem</h3>
            <div class="formula-box">
                A polynomial f(x) has a factor <strong>(x - k)</strong> if and only if <strong>f(k) = 0</strong>
            </div>
            <div class="info-box">
                <p><strong>In other words:</strong> (x - k) is a factor of f(x) if and only if k is a zero of f.</p>
                <p>Use synthetic division to test if a value is a zero and to find the quotient.</p>
            </div>
        </div>

        <!-- GCF FACTORING SECTION - STEP BY STEP -->
        <div id="gcf" class="section">
            <h2>GCF Factoring - Step by Step</h2>
            <p>Factor out the greatest common factor, then factor completely.</p>

            <div class="score-display">
                Score: <span id="gcf-score">0</span> / <span id="gcf-total">0</span>
                <div class="progress-bar"><div class="progress-fill" id="gcf-progress" style="width:0%"></div></div>
            </div>

            <div class="problem-card">
                <h3>Factor completely:</h3>
                <div class="polynomial-display" id="gcf-problem"></div>

                <!-- Step 1: Identify GCF -->
                <div class="step-container" id="gcf-step1">
                    <div class="step-header">
                        <div class="step-number" id="gcf-step1-num">1</div>
                        <div class="step-title">What is the GCF of all terms?</div>
                    </div>
                    <div class="step-content" id="gcf-step1-content">
                        <div class="input-group">
                            <input type="text" id="gcf-step1-answer" placeholder="e.g., 2x">
                            <button class="btn btn-primary" onclick="checkGCFStep1()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="gcf-step1-complete"></div>
                </div>

                <!-- Step 2: Write remaining polynomial -->
                <div class="step-container hidden" id="gcf-step2">
                    <div class="step-header">
                        <div class="step-number" id="gcf-step2-num">2</div>
                        <div class="step-title">After factoring out the GCF, what's left inside the parentheses?</div>
                    </div>
                    <div class="step-content" id="gcf-step2-content">
                        <div class="input-group">
                            <span style="font-size:1.2em;" id="gcf-partial"></span>
                            <input type="text" id="gcf-step2-answer" placeholder="e.g., x²-4x-5">
                            <span style="font-size:1.2em;">)</span>
                            <button class="btn btn-primary" onclick="checkGCFStep2()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="gcf-step2-complete"></div>
                </div>

                <!-- Step 3: Factor remaining if possible -->
                <div class="step-container hidden" id="gcf-step3">
                    <div class="step-header">
                        <div class="step-number" id="gcf-step3-num">3</div>
                        <div class="step-title">Can the remaining polynomial be factored further? Write the final answer.</div>
                    </div>
                    <div class="step-content" id="gcf-step3-content">
                        <div class="input-group">
                            <input type="text" id="gcf-step3-answer" placeholder="e.g., x(x-5)(x+1)">
                            <button class="btn btn-primary" onclick="checkGCFStep3()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="gcf-step3-complete"></div>
                </div>

                <div class="feedback" id="gcf-feedback"></div>
                <button class="btn btn-success" onclick="newGCFProblem()" style="margin-top:15px;">New Problem</button>
            </div>
        </div>

        <!-- SUM/DIFFERENCE OF CUBES SECTION - STEP BY STEP -->
        <div id="cubes" class="section">
            <h2>Sum and Difference of Cubes - Step by Step</h2>

            <div class="formula-box">
                <strong>a³ + b³ = (a + b)(a² - ab + b²)</strong><br>
                <strong>a³ - b³ = (a - b)(a² + ab + b²)</strong><br><br>
                <small>SOAP: <u>S</u>ame, <u>O</u>pposite, <u>A</u>lways <u>P</u>ositive</small>
            </div>

            <div class="score-display">
                Score: <span id="cubes-score">0</span> / <span id="cubes-total">0</span>
                <div class="progress-bar"><div class="progress-fill" id="cubes-progress" style="width:0%"></div></div>
            </div>

            <div class="problem-card">
                <h3>Factor completely:</h3>
                <div class="polynomial-display" id="cubes-problem"></div>

                <!-- Step 1: Sum or Difference? -->
                <div class="step-container" id="cubes-step1">
                    <div class="step-header">
                        <div class="step-number" id="cubes-step1-num">1</div>
                        <div class="step-title">Is this a sum or difference of cubes?</div>
                    </div>
                    <div class="step-content" id="cubes-step1-content">
                        <div class="radio-group">
                            <div class="radio-option" onclick="selectCubesType('sum')">Sum (+)</div>
                            <div class="radio-option" onclick="selectCubesType('diff')">Difference (−)</div>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="cubes-step1-complete"></div>
                </div>

                <!-- Step 2: What is a? -->
                <div class="step-container hidden" id="cubes-step2">
                    <div class="step-header">
                        <div class="step-number" id="cubes-step2-num">2</div>
                        <div class="step-title">What is "a"? (the cube root of the first term)</div>
                    </div>
                    <div class="step-content" id="cubes-step2-content">
                        <div class="input-group">
                            <input type="text" id="cubes-step2-answer" placeholder="e.g., x or 3x">
                            <button class="btn btn-primary" onclick="checkCubesStep2()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="cubes-step2-complete"></div>
                </div>

                <!-- Step 3: What is b? -->
                <div class="step-container hidden" id="cubes-step3">
                    <div class="step-header">
                        <div class="step-number" id="cubes-step3-num">3</div>
                        <div class="step-title">What is "b"? (the cube root of the second term)</div>
                    </div>
                    <div class="step-content" id="cubes-step3-content">
                        <div class="input-group">
                            <input type="text" id="cubes-step3-answer" placeholder="e.g., 2 or 4">
                            <button class="btn btn-primary" onclick="checkCubesStep3()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="cubes-step3-complete"></div>
                </div>

                <!-- Step 4: Write binomial factor -->
                <div class="step-container hidden" id="cubes-step4">
                    <div class="step-header">
                        <div class="step-number" id="cubes-step4-num">4</div>
                        <div class="step-title">Write the binomial factor (a ± b)</div>
                    </div>
                    <div class="step-content" id="cubes-step4-content">
                        <div class="input-group">
                            <input type="text" id="cubes-step4-answer" placeholder="e.g., (x+2)">
                            <button class="btn btn-primary" onclick="checkCubesStep4()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="cubes-step4-complete"></div>
                </div>

                <!-- Step 5: Write trinomial factor -->
                <div class="step-container hidden" id="cubes-step5">
                    <div class="step-header">
                        <div class="step-number" id="cubes-step5-num">5</div>
                        <div class="step-title">Write the trinomial factor (a² ∓ ab + b²)</div>
                    </div>
                    <div class="step-content" id="cubes-step5-content">
                        <div class="input-group">
                            <input type="text" id="cubes-step5-answer" placeholder="e.g., (x²-2x+4)">
                            <button class="btn btn-primary" onclick="checkCubesStep5()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="cubes-step5-complete"></div>
                </div>

                <div class="feedback" id="cubes-feedback"></div>
                <button class="btn btn-success" onclick="newCubesProblem()" style="margin-top:15px;">New Problem</button>
            </div>
        </div>

        <!-- FACTOR BY GROUPING SECTION - STEP BY STEP -->
        <div id="grouping" class="section">
            <h2>Factor by Grouping - Step by Step</h2>
            <p>Group terms, factor each group, then factor out the common binomial.</p>

            <div class="score-display">
                Score: <span id="group-score">0</span> / <span id="group-total">0</span>
                <div class="progress-bar"><div class="progress-fill" id="group-progress" style="width:0%"></div></div>
            </div>

            <div class="problem-card">
                <h3>Factor completely:</h3>
                <div class="polynomial-display" id="group-problem"></div>

                <!-- Step 1: Factor first pair -->
                <div class="step-container" id="group-step1">
                    <div class="step-header">
                        <div class="step-number" id="group-step1-num">1</div>
                        <div class="step-title">Factor out the GCF from the first two terms: <span id="group-first-pair"></span></div>
                    </div>
                    <div class="step-content" id="group-step1-content">
                        <div class="input-group">
                            <input type="text" id="group-step1-answer" placeholder="e.g., x²(x+5)">
                            <button class="btn btn-primary" onclick="checkGroupStep1()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="group-step1-complete"></div>
                </div>

                <!-- Step 2: Factor second pair -->
                <div class="step-container hidden" id="group-step2">
                    <div class="step-header">
                        <div class="step-number" id="group-step2-num">2</div>
                        <div class="step-title">Factor out the GCF from the last two terms: <span id="group-second-pair"></span></div>
                    </div>
                    <div class="step-content" id="group-step2-content">
                        <div class="input-group">
                            <input type="text" id="group-step2-answer" placeholder="e.g., -4(x+5)">
                            <button class="btn btn-primary" onclick="checkGroupStep2()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="group-step2-complete"></div>
                </div>

                <!-- Step 3: Identify common binomial -->
                <div class="step-container hidden" id="group-step3">
                    <div class="step-header">
                        <div class="step-number" id="group-step3-num">3</div>
                        <div class="step-title">What is the common binomial factor?</div>
                    </div>
                    <div class="step-content" id="group-step3-content">
                        <div class="input-group">
                            <input type="text" id="group-step3-answer" placeholder="e.g., (x+5)">
                            <button class="btn btn-primary" onclick="checkGroupStep3()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="group-step3-complete"></div>
                </div>

                <!-- Step 4: Final factored form -->
                <div class="step-container hidden" id="group-step4">
                    <div class="step-header">
                        <div class="step-number" id="group-step4-num">4</div>
                        <div class="step-title">Write the completely factored form</div>
                    </div>
                    <div class="step-content" id="group-step4-content">
                        <div class="input-group">
                            <input type="text" id="group-step4-answer" placeholder="e.g., (x+5)(x-2)(x+2)">
                            <button class="btn btn-primary" onclick="checkGroupStep4()">Check</button>
                        </div>
                    </div>
                    <div class="step-completed-text hidden" id="group-step4-complete"></div>
                </div>

                <div class="feedback" id="group-feedback"></div>
                <button class="btn btn-success" onclick="newGroupingProblem()" style="margin-top:15px;">New Problem</button>
            </div>
        </div>

        <!-- FACTOR THEOREM SECTION -->
        <div id="theorem" class="section">
            <h2>Factor Theorem Explorer</h2>

            <div class="info-box">
                <p><strong>Factor Theorem:</strong> (x - k) is a factor of f(x) if and only if f(k) = 0</p>
            </div>

            <div class="problem-card">
                <h3>Test if a binomial is a factor:</h3>
                <div class="polynomial-display" id="theorem-polynomial">f(x) = x³ - 6x² + 11x - 6</div>

                <p>Is <span id="theorem-binomial" style="font-weight:bold;color:#667eea;">(x - 2)</span> a factor?</p>

                <div class="options">
                    <button class="option-btn" onclick="checkTheorem(true)">Yes, it's a factor</button>
                    <button class="option-btn" onclick="checkTheorem(false)">No, it's not a factor</button>
                </div>

                <div class="feedback" id="theorem-feedback"></div>
                <div id="theorem-work" class="step-display" style="display:none;"></div>

                <button class="btn btn-success" onclick="newTheoremProblem()" style="margin-top:15px;">New Problem</button>
            </div>

            <h3>Graph Visualization</h3>
            <div id="theorem-graph" class="graph-container"></div>
        </div>

        <!-- PRACTICE QUIZ SECTION -->
        <div id="practice" class="section">
            <h2>Mixed Factoring Practice</h2>
            <p>Test your skills with all factoring techniques!</p>

            <div class="score-display">
                Score: <span id="quiz-score">0</span> / <span id="quiz-total">0</span>
                <div class="progress-bar"><div class="progress-fill" id="quiz-progress" style="width:0%"></div></div>
            </div>

            <div id="quiz-container"></div>

            <button class="btn btn-primary" onclick="generateQuiz()" style="margin-top:20px;">New Quiz</button>
        </div>
    </div>

    <script>
        // Global state
        let gcfScore = 0, gcfTotal = 0;
        let cubesScore = 0, cubesTotal = 0;
        let groupScore = 0, groupTotal = 0;
        let quizScore = 0, quizTotal = 0;
        let currentGCF = null;
        let currentCubes = null;
        let currentGrouping = null;
        let currentTheorem = null;

        // Tab navigation
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');

            if (id === 'gcf' && !currentGCF) newGCFProblem();
            if (id === 'cubes' && !currentCubes) newCubesProblem();
            if (id === 'grouping' && !currentGrouping) newGroupingProblem();
            if (id === 'theorem' && !currentTheorem) newTheoremProblem();
            if (id === 'practice' && quizTotal === 0) generateQuiz();
        }

        // Normalize answer for comparison
        function normalizeAnswer(str) {
            return str.replace(/\s+/g, '').replace(/\*/g, '').replace(/\^/g, '').toLowerCase();
        }

        function checkAnswerMatch(userAnswer, correctAnswers) {
            const normalized = normalizeAnswer(userAnswer);
            return correctAnswers.some(ans => normalizeAnswer(ans) === normalized);
        }

        // =====================
        // GCF FACTORING - STEP BY STEP
        // =====================
        const gcfProblems = [
            {
                expr: "x³ - 4x² - 5x",
                gcf: ["x"],
                remaining: ["x²-4x-5", "x^2-4x-5"],
                final: ["x(x-5)(x+1)", "x(x+1)(x-5)"]
            },
            {
                expr: "2x³ - 18x",
                gcf: ["2x"],
                remaining: ["x²-9", "x^2-9"],
                final: ["2x(x-3)(x+3)", "2x(x+3)(x-3)"]
            },
            {
                expr: "3y⁵ - 48y³",
                gcf: ["3y³", "3y^3"],
                remaining: ["y²-16", "y^2-16"],
                final: ["3y³(y-4)(y+4)", "3y^3(y-4)(y+4)", "3y³(y+4)(y-4)", "3y^3(y+4)(y-4)"]
            },
            {
                expr: "x⁴ - 16x²",
                gcf: ["x²", "x^2"],
                remaining: ["x²-16", "x^2-16"],
                final: ["x²(x-4)(x+4)", "x^2(x-4)(x+4)", "x²(x+4)(x-4)", "x^2(x+4)(x-4)"]
            },
            {
                expr: "4x³ - 36x",
                gcf: ["4x"],
                remaining: ["x²-9", "x^2-9"],
                final: ["4x(x-3)(x+3)", "4x(x+3)(x-3)"]
            },
            {
                expr: "x³ - 7x² + 10x",
                gcf: ["x"],
                remaining: ["x²-7x+10", "x^2-7x+10"],
                final: ["x(x-2)(x-5)", "x(x-5)(x-2)"]
            },
        ];

        let gcfStep = 1;

        function newGCFProblem() {
            currentGCF = gcfProblems[Math.floor(Math.random() * gcfProblems.length)];
            gcfStep = 1;

            document.getElementById('gcf-problem').textContent = currentGCF.expr;

            // Reset all steps
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`gcf-step${i}`).classList.remove('hidden');
                document.getElementById(`gcf-step${i}-num`).classList.remove('step-completed');
                document.getElementById(`gcf-step${i}-content`).classList.remove('hidden');
                document.getElementById(`gcf-step${i}-complete`).classList.add('hidden');
                if (document.getElementById(`gcf-step${i}-answer`)) {
                    document.getElementById(`gcf-step${i}-answer`).value = '';
                    document.getElementById(`gcf-step${i}-answer`).classList.remove('correct', 'incorrect');
                }
            }

            // Hide steps 2 and 3 initially
            document.getElementById('gcf-step2').classList.add('hidden');
            document.getElementById('gcf-step3').classList.add('hidden');

            document.getElementById('gcf-feedback').className = 'feedback';
            document.getElementById('gcf-feedback').style.display = 'none';
        }

        function checkGCFStep1() {
            const input = document.getElementById('gcf-step1-answer');
            const isCorrect = checkAnswerMatch(input.value, currentGCF.gcf);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('gcf-step1-num').classList.add('step-completed');
                document.getElementById('gcf-step1-content').classList.add('hidden');
                document.getElementById('gcf-step1-complete').textContent = `GCF: ${currentGCF.gcf[0]}`;
                document.getElementById('gcf-step1-complete').classList.remove('hidden');

                // Show step 2
                document.getElementById('gcf-step2').classList.remove('hidden');
                document.getElementById('gcf-partial').textContent = `${currentGCF.gcf[0]}(`;
                gcfStep = 2;
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkGCFStep2() {
            const input = document.getElementById('gcf-step2-answer');
            const isCorrect = checkAnswerMatch(input.value, currentGCF.remaining);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('gcf-step2-num').classList.add('step-completed');
                document.getElementById('gcf-step2-content').classList.add('hidden');
                document.getElementById('gcf-step2-complete').textContent = `${currentGCF.gcf[0]}(${currentGCF.remaining[0]})`;
                document.getElementById('gcf-step2-complete').classList.remove('hidden');

                // Show step 3
                document.getElementById('gcf-step3').classList.remove('hidden');
                gcfStep = 3;
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkGCFStep3() {
            const input = document.getElementById('gcf-step3-answer');
            const isCorrect = checkAnswerMatch(input.value, currentGCF.final);

            gcfTotal++;
            const feedback = document.getElementById('gcf-feedback');

            if (isCorrect) {
                gcfScore++;
                input.classList.add('correct');
                document.getElementById('gcf-step3-num').classList.add('step-completed');
                document.getElementById('gcf-step3-content').classList.add('hidden');
                document.getElementById('gcf-step3-complete').textContent = `Final: ${currentGCF.final[0]}`;
                document.getElementById('gcf-step3-complete').classList.remove('hidden');

                feedback.innerHTML = '<strong>Excellent!</strong> You factored completely!';
                feedback.className = 'feedback correct show';
            } else {
                input.classList.add('incorrect');
                feedback.innerHTML = `<strong>Not quite.</strong> The correct answer is: ${currentGCF.final[0]}`;
                feedback.className = 'feedback incorrect show';
            }

            document.getElementById('gcf-score').textContent = gcfScore;
            document.getElementById('gcf-total').textContent = gcfTotal;
            document.getElementById('gcf-progress').style.width = `${(gcfScore/gcfTotal)*100}%`;
        }

        // =====================
        // SUM/DIFFERENCE OF CUBES - STEP BY STEP
        // =====================
        const cubesProblems = [
            {
                expr: "x³ + 8",
                type: "sum",
                a: ["x"],
                b: ["2"],
                binomial: ["(x+2)", "x+2"],
                trinomial: ["(x²-2x+4)", "(x^2-2x+4)", "x²-2x+4", "x^2-2x+4"]
            },
            {
                expr: "x³ - 27",
                type: "diff",
                a: ["x"],
                b: ["3"],
                binomial: ["(x-3)", "x-3"],
                trinomial: ["(x²+3x+9)", "(x^2+3x+9)", "x²+3x+9", "x^2+3x+9"]
            },
            {
                expr: "8x³ + 1",
                type: "sum",
                a: ["2x"],
                b: ["1"],
                binomial: ["(2x+1)", "2x+1"],
                trinomial: ["(4x²-2x+1)", "(4x^2-2x+1)", "4x²-2x+1", "4x^2-2x+1"]
            },
            {
                expr: "27x³ - 64",
                type: "diff",
                a: ["3x"],
                b: ["4"],
                binomial: ["(3x-4)", "3x-4"],
                trinomial: ["(9x²+12x+16)", "(9x^2+12x+16)", "9x²+12x+16", "9x^2+12x+16"]
            },
            {
                expr: "x³ + 125",
                type: "sum",
                a: ["x"],
                b: ["5"],
                binomial: ["(x+5)", "x+5"],
                trinomial: ["(x²-5x+25)", "(x^2-5x+25)", "x²-5x+25", "x^2-5x+25"]
            },
            {
                expr: "64x³ - 1",
                type: "diff",
                a: ["4x"],
                b: ["1"],
                binomial: ["(4x-1)", "4x-1"],
                trinomial: ["(16x²+4x+1)", "(16x^2+4x+1)", "16x²+4x+1", "16x^2+4x+1"]
            },
        ];

        let cubesStep = 1;

        function newCubesProblem() {
            currentCubes = cubesProblems[Math.floor(Math.random() * cubesProblems.length)];
            cubesStep = 1;

            document.getElementById('cubes-problem').textContent = currentCubes.expr;

            // Reset all steps
            for (let i = 1; i <= 5; i++) {
                const stepEl = document.getElementById(`cubes-step${i}`);
                const numEl = document.getElementById(`cubes-step${i}-num`);
                const contentEl = document.getElementById(`cubes-step${i}-content`);
                const completeEl = document.getElementById(`cubes-step${i}-complete`);

                stepEl.classList.remove('hidden');
                numEl.classList.remove('step-completed');
                contentEl.classList.remove('hidden');
                completeEl.classList.add('hidden');

                if (i >= 2) {
                    stepEl.classList.add('hidden');
                    const input = document.getElementById(`cubes-step${i}-answer`);
                    if (input) {
                        input.value = '';
                        input.classList.remove('correct', 'incorrect');
                    }
                }
            }

            // Reset radio options
            document.querySelectorAll('#cubes-step1 .radio-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            document.getElementById('cubes-feedback').className = 'feedback';
            document.getElementById('cubes-feedback').style.display = 'none';
        }

        function selectCubesType(type) {
            const options = document.querySelectorAll('#cubes-step1 .radio-option');
            options.forEach(opt => opt.classList.remove('selected'));

            const selectedOpt = type === 'sum' ? options[0] : options[1];
            selectedOpt.classList.add('selected');

            const isCorrect = type === currentCubes.type;

            if (isCorrect) {
                selectedOpt.classList.add('correct');
                document.getElementById('cubes-step1-num').classList.add('step-completed');
                document.getElementById('cubes-step1-content').classList.add('hidden');
                const typeText = type === 'sum' ? 'Sum of Cubes' : 'Difference of Cubes';
                document.getElementById('cubes-step1-complete').textContent = typeText;
                document.getElementById('cubes-step1-complete').classList.remove('hidden');

                // Show step 2
                document.getElementById('cubes-step2').classList.remove('hidden');
                cubesStep = 2;
            } else {
                selectedOpt.classList.add('incorrect');
                setTimeout(() => selectedOpt.classList.remove('incorrect', 'selected'), 500);
            }
        }

        function checkCubesStep2() {
            const input = document.getElementById('cubes-step2-answer');
            const isCorrect = checkAnswerMatch(input.value, currentCubes.a);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('cubes-step2-num').classList.add('step-completed');
                document.getElementById('cubes-step2-content').classList.add('hidden');
                document.getElementById('cubes-step2-complete').textContent = `a = ${currentCubes.a[0]}`;
                document.getElementById('cubes-step2-complete').classList.remove('hidden');

                document.getElementById('cubes-step3').classList.remove('hidden');
                cubesStep = 3;
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkCubesStep3() {
            const input = document.getElementById('cubes-step3-answer');
            const isCorrect = checkAnswerMatch(input.value, currentCubes.b);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('cubes-step3-num').classList.add('step-completed');
                document.getElementById('cubes-step3-content').classList.add('hidden');
                document.getElementById('cubes-step3-complete').textContent = `b = ${currentCubes.b[0]}`;
                document.getElementById('cubes-step3-complete').classList.remove('hidden');

                document.getElementById('cubes-step4').classList.remove('hidden');
                cubesStep = 4;
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkCubesStep4() {
            const input = document.getElementById('cubes-step4-answer');
            const isCorrect = checkAnswerMatch(input.value, currentCubes.binomial);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('cubes-step4-num').classList.add('step-completed');
                document.getElementById('cubes-step4-content').classList.add('hidden');
                document.getElementById('cubes-step4-complete').textContent = `Binomial: ${currentCubes.binomial[0]}`;
                document.getElementById('cubes-step4-complete').classList.remove('hidden');

                document.getElementById('cubes-step5').classList.remove('hidden');
                cubesStep = 5;
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkCubesStep5() {
            const input = document.getElementById('cubes-step5-answer');
            const isCorrect = checkAnswerMatch(input.value, currentCubes.trinomial);

            cubesTotal++;
            const feedback = document.getElementById('cubes-feedback');

            if (isCorrect) {
                cubesScore++;
                input.classList.add('correct');
                document.getElementById('cubes-step5-num').classList.add('step-completed');
                document.getElementById('cubes-step5-content').classList.add('hidden');
                document.getElementById('cubes-step5-complete').textContent = `Trinomial: ${currentCubes.trinomial[0]}`;
                document.getElementById('cubes-step5-complete').classList.remove('hidden');

                feedback.innerHTML = `<strong>Perfect!</strong> ${currentCubes.binomial[0]}${currentCubes.trinomial[0]}`;
                feedback.className = 'feedback correct show';
            } else {
                input.classList.add('incorrect');
                feedback.innerHTML = `<strong>Not quite.</strong> The trinomial factor is: ${currentCubes.trinomial[0]}`;
                feedback.className = 'feedback incorrect show';
            }

            document.getElementById('cubes-score').textContent = cubesScore;
            document.getElementById('cubes-total').textContent = cubesTotal;
            document.getElementById('cubes-progress').style.width = `${(cubesScore/cubesTotal)*100}%`;
        }

        // =====================
        // FACTOR BY GROUPING - STEP BY STEP
        // =====================
        const groupingProblems = [
            {
                expr: "x³ + 5x² - 4x - 20",
                firstPair: "x³ + 5x²",
                secondPair: "-4x - 20",
                step1: ["x²(x+5)", "x^2(x+5)"],
                step2: ["-4(x+5)"],
                commonBinomial: ["(x+5)", "x+5"],
                final: ["(x+5)(x-2)(x+2)", "(x+5)(x+2)(x-2)", "(x-2)(x+2)(x+5)", "(x+2)(x-2)(x+5)"]
            },
            {
                expr: "x³ - x² - 9x + 9",
                firstPair: "x³ - x²",
                secondPair: "-9x + 9",
                step1: ["x²(x-1)", "x^2(x-1)"],
                step2: ["-9(x-1)"],
                commonBinomial: ["(x-1)", "x-1"],
                final: ["(x-1)(x-3)(x+3)", "(x-1)(x+3)(x-3)", "(x-3)(x+3)(x-1)", "(x+3)(x-3)(x-1)"]
            },
            {
                expr: "x³ + 2x² - x - 2",
                firstPair: "x³ + 2x²",
                secondPair: "-x - 2",
                step1: ["x²(x+2)", "x^2(x+2)"],
                step2: ["-1(x+2)", "-(x+2)"],
                commonBinomial: ["(x+2)", "x+2"],
                final: ["(x+2)(x-1)(x+1)", "(x+2)(x+1)(x-1)", "(x-1)(x+1)(x+2)", "(x+1)(x-1)(x+2)"]
            },
            {
                expr: "x³ - 3x² - 4x + 12",
                firstPair: "x³ - 3x²",
                secondPair: "-4x + 12",
                step1: ["x²(x-3)", "x^2(x-3)"],
                step2: ["-4(x-3)"],
                commonBinomial: ["(x-3)", "x-3"],
                final: ["(x-3)(x-2)(x+2)", "(x-3)(x+2)(x-2)", "(x-2)(x+2)(x-3)", "(x+2)(x-2)(x-3)"]
            },
        ];

        let groupStep = 1;

        function newGroupingProblem() {
            currentGrouping = groupingProblems[Math.floor(Math.random() * groupingProblems.length)];
            groupStep = 1;

            document.getElementById('group-problem').textContent = currentGrouping.expr;
            document.getElementById('group-first-pair').textContent = currentGrouping.firstPair;
            document.getElementById('group-second-pair').textContent = currentGrouping.secondPair;

            // Reset all steps
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`group-step${i}`).classList.remove('hidden');
                document.getElementById(`group-step${i}-num`).classList.remove('step-completed');
                document.getElementById(`group-step${i}-content`).classList.remove('hidden');
                document.getElementById(`group-step${i}-complete`).classList.add('hidden');
                if (document.getElementById(`group-step${i}-answer`)) {
                    document.getElementById(`group-step${i}-answer`).value = '';
                    document.getElementById(`group-step${i}-answer`).classList.remove('correct', 'incorrect');
                }
            }

            // Hide steps 2-4 initially
            document.getElementById('group-step2').classList.add('hidden');
            document.getElementById('group-step3').classList.add('hidden');
            document.getElementById('group-step4').classList.add('hidden');

            document.getElementById('group-feedback').className = 'feedback';
            document.getElementById('group-feedback').style.display = 'none';
        }

        function checkGroupStep1() {
            const input = document.getElementById('group-step1-answer');
            const isCorrect = checkAnswerMatch(input.value, currentGrouping.step1);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('group-step1-num').classList.add('step-completed');
                document.getElementById('group-step1-content').classList.add('hidden');
                document.getElementById('group-step1-complete').textContent = currentGrouping.step1[0];
                document.getElementById('group-step1-complete').classList.remove('hidden');

                document.getElementById('group-step2').classList.remove('hidden');
                groupStep = 2;
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkGroupStep2() {
            const input = document.getElementById('group-step2-answer');
            const isCorrect = checkAnswerMatch(input.value, currentGrouping.step2);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('group-step2-num').classList.add('step-completed');
                document.getElementById('group-step2-content').classList.add('hidden');
                document.getElementById('group-step2-complete').textContent = currentGrouping.step2[0];
                document.getElementById('group-step2-complete').classList.remove('hidden');

                document.getElementById('group-step3').classList.remove('hidden');
                groupStep = 3;
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkGroupStep3() {
            const input = document.getElementById('group-step3-answer');
            const isCorrect = checkAnswerMatch(input.value, currentGrouping.commonBinomial);

            if (isCorrect) {
                input.classList.add('correct');
                document.getElementById('group-step3-num').classList.add('step-completed');
                document.getElementById('group-step3-content').classList.add('hidden');
                document.getElementById('group-step3-complete').textContent = `Common binomial: ${currentGrouping.commonBinomial[0]}`;
                document.getElementById('group-step3-complete').classList.remove('hidden');

                document.getElementById('group-step4').classList.remove('hidden');
                groupStep = 4;
            } else {
                input.classList.add('incorrect');
                setTimeout(() => input.classList.remove('incorrect'), 500);
            }
        }

        function checkGroupStep4() {
            const input = document.getElementById('group-step4-answer');
            const isCorrect = checkAnswerMatch(input.value, currentGrouping.final);

            groupTotal++;
            const feedback = document.getElementById('group-feedback');

            if (isCorrect) {
                groupScore++;
                input.classList.add('correct');
                document.getElementById('group-step4-num').classList.add('step-completed');
                document.getElementById('group-step4-content').classList.add('hidden');
                document.getElementById('group-step4-complete').textContent = `Final: ${currentGrouping.final[0]}`;
                document.getElementById('group-step4-complete').classList.remove('hidden');

                feedback.innerHTML = '<strong>Excellent!</strong> Perfect factoring by grouping!';
                feedback.className = 'feedback correct show';
            } else {
                input.classList.add('incorrect');
                feedback.innerHTML = `<strong>Not quite.</strong> The correct answer is: ${currentGrouping.final[0]}`;
                feedback.className = 'feedback incorrect show';
            }

            document.getElementById('group-score').textContent = groupScore;
            document.getElementById('group-total').textContent = groupTotal;
            document.getElementById('group-progress').style.width = `${(groupScore/groupTotal)*100}%`;
        }

        // =====================
        // FACTOR THEOREM
        // =====================
        const theoremProblems = [
            {poly: "x³ - 6x² + 11x - 6", coeffs: [1, -6, 11, -6], testValue: 2, isFactor: true},
            {poly: "x³ - 6x² + 11x - 6", coeffs: [1, -6, 11, -6], testValue: 1, isFactor: true},
            {poly: "x³ - 6x² + 11x - 6", coeffs: [1, -6, 11, -6], testValue: 3, isFactor: true},
            {poly: "x³ - 6x² + 11x - 6", coeffs: [1, -6, 11, -6], testValue: 4, isFactor: false},
            {poly: "x³ + 2x² - 5x - 6", coeffs: [1, 2, -5, -6], testValue: 2, isFactor: true},
            {poly: "x³ + 2x² - 5x - 6", coeffs: [1, 2, -5, -6], testValue: -1, isFactor: true},
            {poly: "x³ + 2x² - 5x - 6", coeffs: [1, 2, -5, -6], testValue: 4, isFactor: false},
            {poly: "2x³ - 3x² - 11x + 6", coeffs: [2, -3, -11, 6], testValue: 3, isFactor: true},
            {poly: "2x³ - 3x² - 11x + 6", coeffs: [2, -3, -11, 6], testValue: 2, isFactor: false},
        ];

        function newTheoremProblem() {
            currentTheorem = theoremProblems[Math.floor(Math.random() * theoremProblems.length)];
            document.getElementById('theorem-polynomial').textContent = `f(x) = ${currentTheorem.poly}`;

            const k = currentTheorem.testValue;
            const binomial = k >= 0 ? `(x - ${k})` : `(x + ${Math.abs(k)})`;
            document.getElementById('theorem-binomial').textContent = binomial;

            document.getElementById('theorem-feedback').className = 'feedback';
            document.getElementById('theorem-work').style.display = 'none';

            document.querySelectorAll('#theorem .option-btn').forEach(b => {
                b.disabled = false;
                b.classList.remove('correct', 'incorrect');
            });

            drawTheoremGraph();
        }

        function checkTheorem(userSaysYes) {
            const feedback = document.getElementById('theorem-feedback');
            const workDiv = document.getElementById('theorem-work');
            const correct = userSaysYes === currentTheorem.isFactor;

            document.querySelectorAll('#theorem .option-btn').forEach(b => b.disabled = true);

            const k = currentTheorem.testValue;
            const coeffs = currentTheorem.coeffs;
            let result = coeffs[0];
            for (let i = 1; i < coeffs.length; i++) {
                result = result * k + coeffs[i];
            }

            if (correct) {
                event.target.classList.add('correct');
                feedback.innerHTML = '<strong>Correct!</strong>';
                feedback.className = 'feedback correct show';
            } else {
                event.target.classList.add('incorrect');
                feedback.innerHTML = '<strong>Incorrect.</strong>';
                feedback.className = 'feedback incorrect show';
            }

            workDiv.style.display = 'block';
            workDiv.innerHTML = `
                <strong>Solution:</strong><br>
                To test if (x - ${k}) is a factor, evaluate f(${k}):<br><br>
                f(${k}) = ${coeffs[0]}(${k})³ + (${coeffs[1]})(${k})² + (${coeffs[2]})(${k}) + (${coeffs[3]})<br>
                f(${k}) = ${result}<br><br>
                Since f(${k}) ${result === 0 ? '= 0' : '≠ 0'}, (x - ${k}) <strong>${result === 0 ? 'IS' : 'is NOT'}</strong> a factor.
            `;
        }

        function drawTheoremGraph() {
            const coeffs = currentTheorem.coeffs;
            const xVals = [], yVals = [];

            for (let x = -5; x <= 7; x += 0.1) {
                xVals.push(x);
                let y = 0;
                for (let i = 0; i < coeffs.length; i++) {
                    y += coeffs[i] * Math.pow(x, coeffs.length - 1 - i);
                }
                yVals.push(y);
            }

            const k = currentTheorem.testValue;
            let fk = 0;
            for (let i = 0; i < coeffs.length; i++) {
                fk += coeffs[i] * Math.pow(k, coeffs.length - 1 - i);
            }

            Plotly.newPlot('theorem-graph', [
                {x: xVals, y: yVals, type: 'scatter', mode: 'lines', line: {color: '#667eea', width: 3}, name: 'f(x)'},
                {x: [k], y: [fk], type: 'scatter', mode: 'markers', marker: {color: fk === 0 ? '#28a745' : '#dc3545', size: 12}, name: `f(${k}) = ${fk}`}
            ], {
                title: `Graph of f(x) = ${currentTheorem.poly}`,
                xaxis: {title: 'x', zeroline: true, zerolinecolor: '#999', range: [-5, 7]},
                yaxis: {title: 'f(x)', zeroline: true, zerolinecolor: '#999'},
                margin: {t: 50, b: 50, l: 50, r: 30},
                showlegend: true
            }, {responsive: true});
        }

        // =====================
        // PRACTICE QUIZ
        // =====================
        function generateQuiz() {
            quizScore = 0;
            quizTotal = 0;
            document.getElementById('quiz-score').textContent = '0';
            document.getElementById('quiz-total').textContent = '0';
            document.getElementById('quiz-progress').style.width = '0%';

            const questions = [
                {q: "Factor: x³ - 8", options: ["(x-2)(x²+2x+4)", "(x-2)(x²-2x+4)", "(x+2)(x²-2x+4)", "(x-2)³"], correct: 0},
                {q: "Factor: x³ + 64", options: ["(x+4)(x²+4x+16)", "(x+4)(x²-4x+16)", "(x-4)(x²+4x+16)", "(x+4)³"], correct: 1},
                {q: "Factor: x³ - 4x² - 9x + 36", options: ["(x-4)(x-3)(x+3)", "(x+4)(x-3)(x+3)", "(x-4)(x²-9)", "(x-4)(x-9)"], correct: 0},
                {q: "Factor: 2x³ - 50x", options: ["2x(x-5)(x+5)", "2x(x²-25)", "2(x³-25x)", "x(2x-50)"], correct: 0},
                {q: "Is (x-3) a factor of x³ - 7x² + 14x - 8?", options: ["Yes", "No"], correct: 1},
                {q: "Factor: 27x³ + 1", options: ["(3x+1)(9x²-3x+1)", "(3x+1)(9x²+3x+1)", "(3x-1)(9x²+3x+1)", "(27x+1)(x²-x+1)"], correct: 0},
                {q: "What is the GCF of 6x⁴ - 18x³ + 12x²?", options: ["6x²", "6x", "3x²", "2x²"], correct: 0},
                {q: "Factor: x⁴ - 16", options: ["(x²+4)(x-2)(x+2)", "(x-2)²(x+2)²", "(x²-4)(x²+4)", "(x-4)(x+4)"], correct: 0},
            ];

            const shuffled = [...questions].sort(() => Math.random() - 0.5).slice(0, 5);
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            shuffled.forEach((q, idx) => {
                const div = document.createElement('div');
                div.className = 'problem-card';
                div.innerHTML = `
                    <h3>Question ${idx + 1}</h3>
                    <p style="font-size:1.1em;"><strong>${q.q}</strong></p>
                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <button class="option-btn" onclick="checkQuizAnswer(this, ${i === q.correct}, ${idx})">${opt}</button>
                        `).join('')}
                    </div>
                    <div class="feedback" id="quiz-feedback-${idx}"></div>
                `;
                container.appendChild(div);
            });

            quizTotal = shuffled.length;
            document.getElementById('quiz-total').textContent = quizTotal;
        }

        function checkQuizAnswer(btn, correct, idx) {
            const feedback = document.getElementById(`quiz-feedback-${idx}`);
            btn.parentElement.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

            if (correct) {
                btn.classList.add('correct');
                quizScore++;
                feedback.innerHTML = '<strong>Correct!</strong>';
                feedback.className = 'feedback correct show';
            } else {
                btn.classList.add('incorrect');
                feedback.innerHTML = '<strong>Incorrect.</strong>';
                feedback.className = 'feedback incorrect show';
            }

            document.getElementById('quiz-score').textContent = quizScore;
            document.getElementById('quiz-progress').style.width = `${(quizScore/quizTotal)*100}%`;
        }
    </script>
</body>
</html>
