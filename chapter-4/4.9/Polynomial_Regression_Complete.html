<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polynomial Regression - Polynomial Modeling</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .back-button {
            display: inline-block;
            margin-bottom: 15px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            transition: background 0.3s;
        }
        .back-button:hover { background: rgba(255,255,255,0.3); }
        h1 { font-size: 2.5em; margin-bottom: 10px; }
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #56ab2f;
            overflow-x: auto;
        }
        .tab {
            flex: 1;
            min-width: 120px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #e9ecef;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
        }
        .tab:hover { background: #dee2e6; }
        .tab.active { background: white; color: #56ab2f; }
        .content { padding: 40px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h2 { color: #56ab2f; margin-bottom: 20px; font-size: 2em; }
        h3 { color: #56ab2f; margin: 25px 0 15px 0; font-size: 1.4em; }
        p { line-height: 1.8; color: #333; margin-bottom: 15px; }
        .concept-box {
            background: #e8f5e9;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid #56ab2f;
        }
        .concept-box strong { color: #56ab2f; font-size: 1.1em; }
        .example {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }
        .step-indicator { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
        .step-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
        }
        .step-dot.active { background: #56ab2f; color: white; transform: scale(1.2); }
        .step-dot.completed { background: #a8e063; color: white; }
        .nav-button {
            padding: 12px 24px;
            background: #56ab2f;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        .nav-button:hover:not(:disabled) { background: #a8e063; transform: translateY(-2px); }
        .nav-button:disabled { background: #ccc; cursor: not-allowed; }
        .example-nav { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .practice-problem {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }
        .input-group { margin: 15px 0; }
        label { display: block; margin-bottom: 8px; color: #495057; font-weight: 600; }
        input[type="number"], input[type="text"] {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        input:focus { outline: none; border-color: #56ab2f; }
        .submit-button {
            padding: 12px 30px;
            background: #56ab2f;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 15px;
        }
        .submit-button:hover { background: #a8e063; transform: translateY(-2px); }
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            display: none;
        }
        .feedback.correct { background: #d4edda; color: #155724; border: 2px solid #c3e6cb; display: block; }
        .feedback.incorrect { background: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; display: block; }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .difficulty-selector { display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap; }
        .difficulty-button {
            padding: 10px 20px;
            border: 2px solid #56ab2f;
            background: white;
            color: #56ab2f;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .difficulty-button.active { background: #56ab2f; color: white; }
        .score-display {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }
        .score-display h3 { color: white; margin: 0 0 10px 0; }
        .graph-container { margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 12px; }
        .equation-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
        .data-table {
            width: 100%;
            max-width: 600px;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .data-table th, .data-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .data-table th { background: #56ab2f; color: white; }
        .data-table tr:nth-child(even) { background: #f8f9fa; }
        .controls { display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap; align-items: center; }
        select {
            padding: 10px 15px;
            border: 2px solid #56ab2f;
            border-radius: 8px;
            font-size: 1em;
            background: white;
        }
        @media (max-width: 768px) {
            body { padding: 10px; }
            .content { padding: 20px; }
            h1 { font-size: 2em; }
            h2 { font-size: 1.5em; }
            .tab { font-size: 0.9em; padding: 15px 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-button">← Back to Section 4.9</a>
            <h1>Polynomial Regression</h1>
            <p>Fit polynomial models to data points</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="showTab('learn')">Learn</button>
            <button class="tab" onclick="showTab('see')">See</button>
            <button class="tab" onclick="showTab('practice')">Practice</button>
            <button class="tab" onclick="showTab('do')">Do</button>
        </div>

        <div class="content">
            <!-- LEARN TAB -->
            <div id="learn" class="tab-content active">
                <h2>Understanding Polynomial Regression</h2>

                <p>
                    When you have data points and want to find a polynomial that passes through them or fits them
                    as closely as possible, you use polynomial regression. There are two main approaches:
                    exact fitting and best-fit curves.
                </p>

                <div class="concept-box">
                    <strong>Exact Fit (n+1 points → degree n polynomial):</strong>
                    <p style="margin-top: 10px;">
                        If you have exactly n+1 points, you can find a unique polynomial of degree n that
                        passes through all of them. For example:
                    </p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>2 points → linear (degree 1)</li>
                        <li>3 points → quadratic (degree 2)</li>
                        <li>4 points → cubic (degree 3)</li>
                    </ul>
                </div>

                <h3>Method 1: Systems of Equations</h3>
                <p>
                    For an exact fit, substitute each point into the general polynomial form and solve the
                    resulting system of equations.
                </p>
                <p>
                    For a quadratic y = ax² + bx + c with three points (x₁, y₁), (x₂, y₂), (x₃, y₃):
                </p>
                <div class="equation-display">
                    y₁ = a(x₁)² + b(x₁) + c<br>
                    y₂ = a(x₂)² + b(x₂) + c<br>
                    y₃ = a(x₃)² + b(x₃) + c
                </div>
                <p>
                    Solve this system for a, b, and c.
                </p>

                <h3>Method 2: Regression (Best Fit)</h3>
                <p>
                    When you have more points than needed, or data with noise, regression finds the polynomial
                    that minimizes the total error. Calculators and computers use least-squares regression.
                </p>

                <div class="concept-box">
                    <strong>Choosing the Right Degree:</strong>
                    <p style="margin-top: 10px;">
                        Use finite differences or the shape of the scatter plot to determine the appropriate degree.
                        A higher degree isn't always better - it can lead to overfitting.
                    </p>
                </div>

                <h3>Interactive Demo</h3>
                <p>See how different degree polynomials fit the same data:</p>
                <div class="graph-container">
                    <div id="learn-graph" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="controls">
                    <label>Degree:</label>
                    <select id="degree-select" onchange="updateLearnGraph()">
                        <option value="1">Linear (degree 1)</option>
                        <option value="2" selected>Quadratic (degree 2)</option>
                        <option value="3">Cubic (degree 3)</option>
                    </select>
                </div>
            </div>

            <!-- SEE TAB -->
            <div id="see" class="tab-content">
                <h2>Worked Examples</h2>

                <div class="step-indicator">
                    <div class="step-dot active" id="see-dot-1">1</div>
                    <div class="step-dot" id="see-dot-2">2</div>
                    <div class="step-dot" id="see-dot-3">3</div>
                </div>

                <div id="see-example-1" class="example">
                    <h3>Example 1: Finding a Quadratic Through 3 Points</h3>
                    <p><strong>Given points:</strong> (0, 2), (1, 5), (2, 14)</p>
                    <p><strong>Find:</strong> y = ax² + bx + c</p>

                    <p><strong>Step 1:</strong> Substitute each point:</p>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>(0, 2): 2 = a(0)² + b(0) + c → c = 2</li>
                        <li>(1, 5): 5 = a(1)² + b(1) + c → a + b + c = 5</li>
                        <li>(2, 14): 14 = a(2)² + b(2) + c → 4a + 2b + c = 14</li>
                    </ul>

                    <p><strong>Step 2:</strong> Use c = 2 in other equations:</p>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>a + b + 2 = 5 → a + b = 3</li>
                        <li>4a + 2b + 2 = 14 → 4a + 2b = 12 → 2a + b = 6</li>
                    </ul>

                    <p><strong>Step 3:</strong> Solve for a and b:</p>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>(2a + b) - (a + b) = 6 - 3 → a = 3</li>
                        <li>3 + b = 3 → b = 0</li>
                    </ul>

                    <div class="equation-display">y = 3x² + 2</div>

                    <div class="graph-container">
                        <div id="example1-graph" style="width: 100%; height: 300px;"></div>
                    </div>
                </div>

                <div id="see-example-2" class="example" style="display: none;">
                    <h3>Example 2: Finding a Linear Function</h3>
                    <p><strong>Given points:</strong> (1, 4), (3, 10)</p>
                    <p><strong>Find:</strong> y = mx + b</p>

                    <p><strong>Step 1:</strong> Calculate slope:</p>
                    <div class="equation-display">m = (10 - 4)/(3 - 1) = 6/2 = 3</div>

                    <p><strong>Step 2:</strong> Use point-slope form with (1, 4):</p>
                    <div class="equation-display">
                        y - 4 = 3(x - 1)<br>
                        y = 3x - 3 + 4<br>
                        y = 3x + 1
                    </div>

                    <p><strong>Verify with (3, 10):</strong> y = 3(3) + 1 = 10 ✓</p>

                    <div class="graph-container">
                        <div id="example2-graph" style="width: 100%; height: 300px;"></div>
                    </div>
                </div>

                <div id="see-example-3" class="example" style="display: none;">
                    <h3>Example 3: Cubic Through 4 Points</h3>
                    <p><strong>Given points:</strong> (0, 0), (1, 2), (2, 16), (3, 54)</p>
                    <p><strong>Find:</strong> y = ax³ + bx² + cx + d</p>

                    <p><strong>Step 1:</strong> From (0, 0): d = 0</p>

                    <p><strong>Step 2:</strong> Remaining equations:</p>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>(1, 2): a + b + c = 2</li>
                        <li>(2, 16): 8a + 4b + 2c = 16 → 4a + 2b + c = 8</li>
                        <li>(3, 54): 27a + 9b + 3c = 54 → 9a + 3b + c = 18</li>
                    </ul>

                    <p><strong>Step 3:</strong> Eliminate c:</p>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>(4a + 2b + c) - (a + b + c) = 8 - 2 → 3a + b = 6</li>
                        <li>(9a + 3b + c) - (a + b + c) = 18 - 2 → 8a + 2b = 16 → 4a + b = 8</li>
                    </ul>

                    <p><strong>Step 4:</strong> Solve:</p>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li>(4a + b) - (3a + b) = 8 - 6 → a = 2</li>
                        <li>3(2) + b = 6 → b = 0</li>
                        <li>2 + 0 + c = 2 → c = 0</li>
                    </ul>

                    <div class="equation-display">y = 2x³</div>

                    <div class="graph-container">
                        <div id="example3-graph" style="width: 100%; height: 300px;"></div>
                    </div>
                </div>

                <div class="example-nav">
                    <button class="nav-button" onclick="previousSeeExample()" id="see-prev">Previous</button>
                    <button class="nav-button" onclick="nextSeeExample()" id="see-next">Next Example</button>
                </div>
            </div>

            <!-- PRACTICE TAB -->
            <div id="practice" class="tab-content">
                <h2>Practice Problems</h2>
                <p>Find the polynomial equation that passes through the given points.</p>

                <div class="progress-bar">
                    <div class="progress-fill" id="practice-progress" style="width: 0%">0%</div>
                </div>

                <div id="practice-problem-container"></div>

                <div class="score-display" id="practice-score-display" style="display: none;">
                    <h3>Practice Complete!</h3>
                    <p id="practice-final-score"></p>
                    <button class="nav-button" onclick="resetPractice()">Try Again</button>
                </div>
            </div>

            <!-- DO TAB -->
            <div id="do" class="tab-content">
                <h2>Independent Practice</h2>
                <p>Find polynomial equations through given points. Choose your difficulty level.</p>

                <div class="difficulty-selector">
                    <button class="difficulty-button active" onclick="setDifficulty('easy')">Easy</button>
                    <button class="difficulty-button" onclick="setDifficulty('medium')">Medium</button>
                    <button class="difficulty-button" onclick="setDifficulty('hard')">Hard</button>
                </div>

                <div class="score-display">
                    <h3>Your Score</h3>
                    <p id="do-score">0 / 0 (0%)</p>
                </div>

                <div id="do-problem-container"></div>

                <div class="graph-container">
                    <div id="do-graph" style="width: 100%; height: 350px;"></div>
                </div>

                <div class="input-group">
                    <label>Enter coefficient a:</label>
                    <input type="number" id="do-a" step="0.1" placeholder="a = ?">
                </div>
                <div class="input-group">
                    <label>Enter coefficient b:</label>
                    <input type="number" id="do-b" step="0.1" placeholder="b = ?">
                </div>
                <div class="input-group" id="c-input">
                    <label>Enter coefficient c:</label>
                    <input type="number" id="do-c" step="0.1" placeholder="c = ?">
                </div>

                <button class="submit-button" onclick="checkDoAnswer()">Submit Answer</button>
                <button class="nav-button" onclick="newDoProblem()" style="margin-left: 10px;">New Problem</button>

                <div id="do-feedback" class="feedback"></div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'see') initSeeGraphs();
        }

        // Learn tab
        const learnData = [[0, 2], [1, 3], [2, 6], [3, 11], [4, 18]];

        function polyFit(points, degree) {
            // Simple polynomial fit using Vandermonde matrix
            const n = points.length;
            const X = [];
            const Y = points.map(p => p[1]);

            for (let i = 0; i < n; i++) {
                const row = [];
                for (let j = 0; j <= degree; j++) {
                    row.push(Math.pow(points[i][0], j));
                }
                X.push(row);
            }

            // Solve using normal equations (simplified)
            const coeffs = solveSystem(X, Y, degree + 1);
            return coeffs;
        }

        function solveSystem(X, Y, size) {
            // Simplified least squares solution
            const XtX = [];
            const XtY = [];

            for (let i = 0; i < size; i++) {
                XtX[i] = [];
                XtY[i] = 0;
                for (let j = 0; j < size; j++) {
                    XtX[i][j] = 0;
                    for (let k = 0; k < X.length; k++) {
                        XtX[i][j] += X[k][i] * X[k][j];
                    }
                }
                for (let k = 0; k < X.length; k++) {
                    XtY[i] += X[k][i] * Y[k];
                }
            }

            // Gaussian elimination
            for (let i = 0; i < size; i++) {
                let max = i;
                for (let j = i + 1; j < size; j++) {
                    if (Math.abs(XtX[j][i]) > Math.abs(XtX[max][i])) max = j;
                }
                [XtX[i], XtX[max]] = [XtX[max], XtX[i]];
                [XtY[i], XtY[max]] = [XtY[max], XtY[i]];

                for (let j = i + 1; j < size; j++) {
                    const f = XtX[j][i] / XtX[i][i];
                    XtY[j] -= f * XtY[i];
                    for (let k = i; k < size; k++) {
                        XtX[j][k] -= f * XtX[i][k];
                    }
                }
            }

            const coeffs = new Array(size);
            for (let i = size - 1; i >= 0; i--) {
                coeffs[i] = XtY[i];
                for (let j = i + 1; j < size; j++) {
                    coeffs[i] -= XtX[i][j] * coeffs[j];
                }
                coeffs[i] /= XtX[i][i];
            }

            return coeffs;
        }

        function evalPoly(coeffs, x) {
            let y = 0;
            for (let i = 0; i < coeffs.length; i++) {
                y += coeffs[i] * Math.pow(x, i);
            }
            return y;
        }

        function updateLearnGraph() {
            const degree = parseInt(document.getElementById('degree-select').value);
            const coeffs = polyFit(learnData, degree);

            const xLine = [];
            const yLine = [];
            for (let x = -0.5; x <= 4.5; x += 0.1) {
                xLine.push(x);
                yLine.push(evalPoly(coeffs, x));
            }

            Plotly.react('learn-graph', [
                {
                    x: learnData.map(p => p[0]),
                    y: learnData.map(p => p[1]),
                    mode: 'markers',
                    type: 'scatter',
                    marker: { size: 12, color: '#56ab2f' },
                    name: 'Data Points'
                },
                {
                    x: xLine,
                    y: yLine,
                    mode: 'lines',
                    type: 'scatter',
                    line: { color: '#a8e063', width: 3 },
                    name: `Degree ${degree} Fit`
                }
            ], {
                title: `Polynomial Regression (Degree ${degree})`,
                xaxis: { title: 'x' },
                yaxis: { title: 'y' },
                showlegend: true
            });
        }

        updateLearnGraph();

        // See tab
        let currentSeeExample = 1;
        const totalSeeExamples = 3;

        function initSeeGraphs() {
            // Example 1: y = 3x² + 2
            const pts1 = [[0, 2], [1, 5], [2, 14]];
            const x1 = [], y1 = [];
            for (let x = -0.5; x <= 2.5; x += 0.1) {
                x1.push(x);
                y1.push(3*x*x + 2);
            }
            Plotly.react('example1-graph', [
                { x: pts1.map(p => p[0]), y: pts1.map(p => p[1]), mode: 'markers', marker: { size: 12, color: '#56ab2f' }, name: 'Points' },
                { x: x1, y: y1, mode: 'lines', line: { color: '#a8e063', width: 3 }, name: 'y = 3x² + 2' }
            ], { showlegend: true, margin: { t: 30 } });

            // Example 2: y = 3x + 1
            const pts2 = [[1, 4], [3, 10]];
            Plotly.react('example2-graph', [
                { x: pts2.map(p => p[0]), y: pts2.map(p => p[1]), mode: 'markers', marker: { size: 12, color: '#56ab2f' }, name: 'Points' },
                { x: [0, 4], y: [1, 13], mode: 'lines', line: { color: '#a8e063', width: 3 }, name: 'y = 3x + 1' }
            ], { showlegend: true, margin: { t: 30 } });

            // Example 3: y = 2x³
            const pts3 = [[0, 0], [1, 2], [2, 16], [3, 54]];
            const x3 = [], y3 = [];
            for (let x = -0.2; x <= 3.2; x += 0.1) {
                x3.push(x);
                y3.push(2*x*x*x);
            }
            Plotly.react('example3-graph', [
                { x: pts3.map(p => p[0]), y: pts3.map(p => p[1]), mode: 'markers', marker: { size: 12, color: '#56ab2f' }, name: 'Points' },
                { x: x3, y: y3, mode: 'lines', line: { color: '#a8e063', width: 3 }, name: 'y = 2x³' }
            ], { showlegend: true, margin: { t: 30 } });
        }

        function nextSeeExample() {
            if (currentSeeExample < totalSeeExamples) {
                document.getElementById(`see-example-${currentSeeExample}`).style.display = 'none';
                document.getElementById(`see-dot-${currentSeeExample}`).classList.remove('active');
                document.getElementById(`see-dot-${currentSeeExample}`).classList.add('completed');
                currentSeeExample++;
                document.getElementById(`see-example-${currentSeeExample}`).style.display = 'block';
                document.getElementById(`see-dot-${currentSeeExample}`).classList.add('active');
                updateSeeButtons();
            }
        }

        function previousSeeExample() {
            if (currentSeeExample > 1) {
                document.getElementById(`see-example-${currentSeeExample}`).style.display = 'none';
                document.getElementById(`see-dot-${currentSeeExample}`).classList.remove('active');
                currentSeeExample--;
                document.getElementById(`see-example-${currentSeeExample}`).style.display = 'block';
                document.getElementById(`see-dot-${currentSeeExample}`).classList.remove('completed');
                document.getElementById(`see-dot-${currentSeeExample}`).classList.add('active');
                updateSeeButtons();
            }
        }

        function updateSeeButtons() {
            document.getElementById('see-prev').disabled = currentSeeExample === 1;
            document.getElementById('see-next').disabled = currentSeeExample === totalSeeExamples;
        }
        updateSeeButtons();

        // Practice tab
        const practiceProblems = [
            { points: [[0, 1], [1, 3]], degree: 1, answer: { a: 2, b: 1 }, form: 'y = ax + b' },
            { points: [[0, 3], [1, 6], [2, 11]], degree: 2, answer: { a: 1, b: 2, c: 3 }, form: 'y = ax² + bx + c' },
            { points: [[1, 5], [2, 8]], degree: 1, answer: { a: 3, b: 2 }, form: 'y = ax + b' },
            { points: [[0, 0], [1, 1], [2, 8]], degree: 2, answer: { a: 3, b: -2, c: 0 }, form: 'y = ax² + bx + c' }
        ];

        let currentPractice = 0;
        let practiceScore = 0;

        function loadPracticeProblems() {
            if (currentPractice < practiceProblems.length) {
                const p = practiceProblems[currentPractice];
                let html = `<div class="practice-problem">
                    <h3>Problem ${currentPractice + 1} of ${practiceProblems.length}</h3>
                    <p>Find the ${p.degree === 1 ? 'linear' : 'quadratic'} equation (${p.form}) through:</p>
                    <table class="data-table"><tr><th>x</th>`;
                p.points.forEach(pt => html += `<td>${pt[0]}</td>`);
                html += '</tr><tr><th>y</th>';
                p.points.forEach(pt => html += `<td>${pt[1]}</td>`);
                html += '</tr></table>';
                html += '<div class="input-group"><label>a = </label><input type="number" id="prac-a" step="0.1"></div>';
                html += '<div class="input-group"><label>b = </label><input type="number" id="prac-b" step="0.1"></div>';
                if (p.degree === 2) {
                    html += '<div class="input-group"><label>c = </label><input type="number" id="prac-c" step="0.1"></div>';
                }
                html += '<button class="submit-button" onclick="checkPracticeAnswer()">Submit</button>';
                html += '<div id="practice-feedback" class="feedback"></div></div>';
                document.getElementById('practice-problem-container').innerHTML = html;

                document.getElementById('prac-a').addEventListener('keypress', e => { if (e.key === 'Enter') checkPracticeAnswer(); });
                document.getElementById('prac-b').addEventListener('keypress', e => { if (e.key === 'Enter') checkPracticeAnswer(); });
                if (p.degree === 2) {
                    document.getElementById('prac-c').addEventListener('keypress', e => { if (e.key === 'Enter') checkPracticeAnswer(); });
                }
            } else {
                showPracticeComplete();
            }
        }

        function checkPracticeAnswer() {
            const p = practiceProblems[currentPractice];
            const a = parseFloat(document.getElementById('prac-a').value);
            const b = parseFloat(document.getElementById('prac-b').value);
            const c = p.degree === 2 ? parseFloat(document.getElementById('prac-c').value) : null;
            const feedback = document.getElementById('practice-feedback');

            let correct = Math.abs(a - p.answer.a) < 0.1 && Math.abs(b - p.answer.b) < 0.1;
            if (p.degree === 2) correct = correct && Math.abs(c - p.answer.c) < 0.1;

            if (correct) {
                feedback.className = 'feedback correct';
                feedback.textContent = 'Correct!';
                practiceScore++;
                setTimeout(() => {
                    currentPractice++;
                    updatePracticeProgress();
                    loadPracticeProblems();
                }, 1500);
            } else {
                feedback.className = 'feedback incorrect';
                let msg = `Not quite. The answer is a=${p.answer.a}, b=${p.answer.b}`;
                if (p.degree === 2) msg += `, c=${p.answer.c}`;
                feedback.textContent = msg;
            }
        }

        function updatePracticeProgress() {
            const pct = (currentPractice / practiceProblems.length) * 100;
            document.getElementById('practice-progress').style.width = pct + '%';
            document.getElementById('practice-progress').textContent = Math.round(pct) + '%';
        }

        function showPracticeComplete() {
            document.getElementById('practice-problem-container').style.display = 'none';
            document.getElementById('practice-score-display').style.display = 'block';
            document.getElementById('practice-final-score').textContent =
                `You got ${practiceScore} out of ${practiceProblems.length} correct (${Math.round(practiceScore/practiceProblems.length*100)}%)`;
        }

        function resetPractice() {
            currentPractice = 0;
            practiceScore = 0;
            document.getElementById('practice-problem-container').style.display = 'block';
            document.getElementById('practice-score-display').style.display = 'none';
            updatePracticeProgress();
            loadPracticeProblems();
        }

        loadPracticeProblems();

        // Do tab
        let doScore = 0, doAttempts = 0, currentDifficulty = 'easy', currentDoProblem = null;

        function setDifficulty(level) {
            currentDifficulty = level;
            document.querySelectorAll('.difficulty-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            newDoProblem();
        }

        function generateDoProblem() {
            let degree = currentDifficulty === 'easy' ? 1 : 2;
            let points = [];
            let answer = {};

            if (degree === 1) {
                answer.a = Math.floor(Math.random() * 5) + 1;
                answer.b = Math.floor(Math.random() * 10) - 5;
                const x1 = Math.floor(Math.random() * 3);
                const x2 = x1 + 1 + Math.floor(Math.random() * 2);
                points = [[x1, answer.a * x1 + answer.b], [x2, answer.a * x2 + answer.b]];
                document.getElementById('c-input').style.display = 'none';
            } else {
                answer.a = Math.floor(Math.random() * 3) + 1;
                answer.b = Math.floor(Math.random() * 5) - 2;
                answer.c = Math.floor(Math.random() * 5);
                for (let x = 0; x < 3; x++) {
                    points.push([x, answer.a * x * x + answer.b * x + answer.c]);
                }
                document.getElementById('c-input').style.display = 'block';
            }

            return { points, degree, answer };
        }

        function newDoProblem() {
            currentDoProblem = generateDoProblem();
            displayDoProblem();
            document.getElementById('do-a').value = '';
            document.getElementById('do-b').value = '';
            document.getElementById('do-c').value = '';
            document.getElementById('do-feedback').style.display = 'none';
        }

        function displayDoProblem() {
            const p = currentDoProblem;
            let html = `<div class="practice-problem"><h3>Find the ${p.degree === 1 ? 'linear (y = ax + b)' : 'quadratic (y = ax² + bx + c)'} equation</h3>
                <table class="data-table"><tr><th>x</th>`;
            p.points.forEach(pt => html += `<td>${pt[0]}</td>`);
            html += '</tr><tr><th>y</th>';
            p.points.forEach(pt => html += `<td>${pt[1]}</td>`);
            html += '</tr></table></div>';
            document.getElementById('do-problem-container').innerHTML = html;

            // Plot points
            Plotly.react('do-graph', [{
                x: p.points.map(pt => pt[0]),
                y: p.points.map(pt => pt[1]),
                mode: 'markers',
                marker: { size: 14, color: '#56ab2f' },
                name: 'Points'
            }], {
                title: 'Data Points',
                xaxis: { title: 'x' },
                yaxis: { title: 'y' }
            });
        }

        function checkDoAnswer() {
            const p = currentDoProblem;
            const a = parseFloat(document.getElementById('do-a').value);
            const b = parseFloat(document.getElementById('do-b').value);
            const c = p.degree === 2 ? parseFloat(document.getElementById('do-c').value) : null;
            const feedback = document.getElementById('do-feedback');

            if (isNaN(a) || isNaN(b) || (p.degree === 2 && isNaN(c))) {
                feedback.className = 'feedback incorrect';
                feedback.textContent = 'Please enter all coefficients.';
                return;
            }

            doAttempts++;
            let correct = Math.abs(a - p.answer.a) < 0.1 && Math.abs(b - p.answer.b) < 0.1;
            if (p.degree === 2) correct = correct && Math.abs(c - p.answer.c) < 0.1;

            if (correct) {
                doScore++;
                feedback.className = 'feedback correct';
                feedback.textContent = 'Correct!';

                // Show fitted curve
                const xLine = [], yLine = [];
                const minX = Math.min(...p.points.map(pt => pt[0])) - 0.5;
                const maxX = Math.max(...p.points.map(pt => pt[0])) + 0.5;
                for (let x = minX; x <= maxX; x += 0.1) {
                    xLine.push(x);
                    yLine.push(p.degree === 1 ? a * x + b : a * x * x + b * x + c);
                }
                Plotly.react('do-graph', [
                    { x: p.points.map(pt => pt[0]), y: p.points.map(pt => pt[1]), mode: 'markers', marker: { size: 14, color: '#56ab2f' }, name: 'Points' },
                    { x: xLine, y: yLine, mode: 'lines', line: { color: '#a8e063', width: 3 }, name: 'Your Equation' }
                ], { title: 'Correct Fit!', xaxis: { title: 'x' }, yaxis: { title: 'y' } });
            } else {
                feedback.className = 'feedback incorrect';
                let msg = `Not quite. The answer is a=${p.answer.a}, b=${p.answer.b}`;
                if (p.degree === 2) msg += `, c=${p.answer.c}`;
                feedback.textContent = msg;
            }

            updateDoScore();
        }

        function updateDoScore() {
            const pct = doAttempts > 0 ? Math.round(doScore / doAttempts * 100) : 0;
            document.getElementById('do-score').textContent = `${doScore} / ${doAttempts} (${pct}%)`;
        }

        document.getElementById('do-a').addEventListener('keypress', e => { if (e.key === 'Enter') checkDoAnswer(); });
        document.getElementById('do-b').addEventListener('keypress', e => { if (e.key === 'Enter') checkDoAnswer(); });
        document.getElementById('do-c').addEventListener('keypress', e => { if (e.key === 'Enter') checkDoAnswer(); });

        newDoProblem();
    </script>
</body>
</html>
